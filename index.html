<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>SSC CHSL Tier-I Mathematics Practice Test</title>
    <style>
        /* (unchanged CSS — same as your original file) */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Arial', sans-serif; line-height: 1.6; color: #333; background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height: 100vh; }
        .container { max-width:1200px;margin:0 auto;padding:20px; }
        .header { text-align:center;background:#fff;padding:40px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.2);margin-bottom:30px;border-top:5px solid #e74c3c; }
        .govt-logo{width:80px;height:80px;background:#e74c3c;border-radius:50%;margin:0 auto 20px;display:flex;align-items:center;justify-content:center;color:white;font-size:24px;font-weight:bold;}
        .header h1{color:#2c3e50;margin-bottom:10px;font-size:2.4em;font-weight:bold;text-transform:uppercase;letter-spacing:1px;}
        .header h2{color:#e74c3c;font-weight:bold;margin-bottom:10px;font-size:1.3em;}
        .header .subtitle{color:#7f8c8d;font-size:1.1em;margin-bottom:20px;font-style:italic;}
        .exam-info {
    background: #f8f9fa;
    padding: 25px 30px;
    border-radius: 12px;
    margin: 20px 0;
    border-left: 6px solid #3498db;
    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.2);
    max-width: 600px;
    text-align: left; /* align text to the left */
    font-size: 16px;
    line-height: 1.6;
    color: #2c3e50;
}

.exam-info h3 {
    color: #2c3e50;
    margin-bottom: 15px;
    font-weight: 700;
    font-size: 1.5em;
    text-align: left; /* ensure heading is aligned left */
}

.exam-info ul {
    list-style: none;
    padding-left: 20px; /* padding for bullet alignment */
    margin: 0;
}

.exam-info li {
    margin: 8px 0;
    padding-left: 20px;
    position: relative;
    text-align: left;
}

.exam-info li:before {
    content: "•"; /* bullet */
    color: #3498db;
    font-weight: bold;
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    font-size: 18px;
}
.btn{background:linear-gradient(45deg,#3498db,#2980b9);color:white;border:none;padding:18px 35px;border-radius:8px;cursor:pointer;font-size:16px;font-weight:bold;text-transform:uppercase;letter-spacing:1px;transition:all 0.3s ease;margin:10px;box-shadow:0 4px 15px rgba(0,0,0,0.2);}
        .btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,0.3);}
        .btn-admin{background:linear-gradient(45deg,#e74c3c,#c0392b);}
        .quiz-container{display:none;background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.2);overflow:hidden;}
        .exam-header{background:linear-gradient(45deg,#2c3e50,#34495e);color:white;padding:20px 30px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;}
        .exam-title{font-size:1.3em;font-weight:bold;}
        .timer-container{background:#e74c3c;padding:12px 20px;border-radius:8px;font-family:'Courier New',monospace;font-size:1.2em;font-weight:bold;box-shadow:0 2px 10px rgba(0,0,0,0.3);min-width:160px;text-align:center;}
        .timer-label{font-size:0.8em;margin-bottom:5px;opacity:0.9;}
        .timer-display{font-size:1.4em;letter-spacing:2px;}
        .timer-warning{background:#f39c12 !important;animation:pulse 1s infinite;}
        .timer-critical{background:#e74c3c !important;animation:flash 0.5s infinite;}
        @keyframes pulse{0%{opacity:1;}50%{opacity:0.7;}100%{opacity:1;}}
        @keyframes flash{0%{opacity:1;}50%{opacity:0.3;}100%{opacity:1;}}
        .user-form{background:#f8f9fa;padding:30px;border-bottom:1px solid #e9ecef;}
        .user-form h3{color:#2c3e50;margin-bottom:20px;font-size:1.4em;}
        .user-form input{width:100%;padding:15px;margin:10px 0;border:2px solid #ddd;border-radius:6px;font-size:16px;transition:border-color 0.3s ease;}
        .user-form input:focus{outline:none;border-color:#3498db;box-shadow:0 0 0 3px rgba(52,152,219,0.1);}
        .question-container{display:none;padding:30px;}
        .question-container.active{display:block;}
        .question{background:#fff;border:2px solid #e9ecef;border-radius:10px;padding:30px;margin-bottom:20px;box-shadow:0 4px 15px rgba(0,0,0,0.1);}
        .question-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px;padding-bottom:15px;border-bottom:2px solid #e9ecef;}
        .question-number{background:linear-gradient(45deg,#3498db,#2980b9);color:white;padding:10px 20px;border-radius:25px;font-weight:bold;font-size:16px;}
        .question-text{font-size:18px;margin-bottom:25px;color:#2c3e50;line-height:1.8;font-weight:500;}
        .options{list-style:none;}
        .option{margin-bottom:15px;padding:15px 20px;border:2px solid #e9ecef;border-radius:8px;cursor:pointer;transition:all 0.3s ease;background:#f8f9fa;position:relative;}
        .option:hover{background:#e3f2fd;border-color:#2196f3;transform:translateX(5px);}
        .option.selected{background:linear-gradient(45deg,#3498db,#2980b9);border-color:#2980b9;color:white;font-weight:bold;}
        .option label{cursor:pointer;display:block;width:100%;font-size:16px;}
        .navigation{display:flex;justify-content:space-between;align-items:center;padding:25px 30px;background:#f8f9fa;border-top:1px solid #e9ecef;}
        .btn-nav{background:linear-gradient(45deg,#27ae60,#2ecc71);color:white;border:none;padding:12px 25px;border-radius:6px;cursor:pointer;font-size:16px;font-weight:bold;text-transform:uppercase;transition:all 0.3s ease;box-shadow:0 3px 10px rgba(0,0,0,0.2);}
        .btn-nav:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,0,0,0.3);}
        .btn-nav:disabled{background:#bdc3c7;cursor:not-allowed;transform:none;box-shadow:none;}
        #submitBtn{background:linear-gradient(45deg,#e74c3c,#c0392b) !important;}
        .progress{flex:1;margin:0 20px;text-align:center;color:#2c3e50;font-size:18px;font-weight:bold;background:white;padding:10px 20px;border-radius:25px;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
        .modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,0.7);backdrop-filter:blur(5px);}
        .modal-content{background-color:#fff;margin:10% auto;padding:40px;border-radius:12px;width:90%;max-width:500px;box-shadow:0 10px 40px rgba(0,0,0,0.3);border-top:5px solid #e74c3c;}
        .modal h3{margin-bottom:25px;color:#2c3e50;font-size:1.5em;}
        .modal input{width:100%;padding:15px;margin:15px 0;border:2px solid #ddd;border-radius:6px;font-size:16px;}
        .close{color:#aaa;float:right;font-size:32px;font-weight:bold;cursor:pointer;margin-top:-15px;}
        .close:hover{color:#e74c3c;}
        .admin-panel{display:none;background:#fff;padding:40px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.2);border-top:5px solid #e74c3c;}
        .response-table{width:100%;border-collapse:collapse;margin-top:20px;font-size:14px;}
        .response-table th,.response-table td{border:1px solid #ddd;padding:12px;text-align:left;}
        .response-table th{background:linear-gradient(45deg,#2c3e50,#34495e);color:white;font-weight:bold;}
        .response-table tr:nth-child(even){background-color:#f9f9f9;}
        .success-message{background:linear-gradient(45deg,#27ae60,#2ecc71);color:white;padding:40px;border-radius:12px;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,0.2);}
        .success-message h3{font-size:2em;margin-bottom:20px;}
        .error-message{background:#f8d7da;color:#721c24;padding:15px;border-radius:8px;text-align:center;margin-top:10px;border:1px solid #f5c6cb;}
        .auto-submit-warning{background:#fff3cd;color:#856404;padding:20px;border-radius:8px;text-align:center;margin:20px 0;border:1px solid #ffeaa7;font-weight:bold;}
        /* responsive css omitted for brevity in this snippet - same as your original file */
    </style>
</head>
<body>
    <div class="container">
        <!-- Landing Page -->
        <div id="landingPage">
            <div class="header">
                <div class="govt-logo">SSC</div>
                <h1>Staff Selection Commission</h1>
                <h2>CHSL Tier-I Mathematics Practice Test 2</h2>
                <p class="subtitle">Combined Higher Secondary Level Examination</p>
                <div class="exam-info">
                    <h3>Examination Instructions:</h3>
                    <ul>
                        <li>Total Questions: 45</li>
                        <li>Maximum Marks: 90</li>
                        <li>Time Duration: <strong style="color: rgb(253, 5, 5); font-weight: 1000; ">1 Hour 15 Minutes</strong></li>
                        <li><strong style="color: rgb(253, 5, 5); font-weight: 1000;">⚠️ Test will auto-submit when time expires</strong></li>
                        <li>Ensure stable internet connection</li>
                        <li><strong style="color: rgb(253, 5, 5); font-weight: 1000;">Do not refresh the page during exam</strong></li>
                        <li>Marking Scheme: +2 for correct, -0.5 for incorrect, 0 for unattempted</li>
                    </ul>
                </div>
                <button class="btn" onclick="startTest()">Start Examination</button>
                <button class="btn btn-admin" onclick="openAdminModal()">Admin Panel</button>
            </div>
        </div>

        <!-- Quiz Container -->
        <div id="quizContainer" class="quiz-container">
            <div class="exam-header">
                <div class="exam-title">SSC CHSL - Mathematics Practice Test</div>
                <div class="timer-container" id="timerContainer">
                    <div class="timer-label">TIME REMAINING</div>
                    <div class="timer-display" id="timerDisplay">01:15:00</div>
                </div>
            </div>

            <!-- User Information Form -->
            <div id="userForm" class="user-form">
                <h3>Candidate Information</h3>
                <input type="text" id="userName" placeholder="Enter your Name" required>
                <input type="email" id="userEmail" placeholder="Enter Given email address" required>
                <button class="btn" onclick="startQuiz()">Begin Examination</button>
            </div>

            <!-- Auto Submit Warning -->
            <div id="autoSubmitWarning" class="auto-submit-warning" style="display: none;">
                ⚠️ WARNING: Test will be automatically submitted in less than 5 minutes!
            </div>

            <!-- Questions will be dynamically inserted here -->
            <div id="questionsContainer"></div>

            <!-- Navigation -->
            <div class="navigation" id="navigation" style="display: none;">
                <button class="btn-nav" id="prevBtn" onclick="previousQuestion()" disabled>Previous</button>
                <div class="progress" id="progress">Question 1 of 45</div>
                <button class="btn-nav" id="nextBtn" onclick="nextQuestion()">Next</button>
                <button class="btn-nav" id="submitBtn" onclick="submitTest()" style="display: none;">Submit Test</button>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="adminPanel" class="admin-panel">
            <h2 style="color: #2c3e50; margin-bottom: 20px;">Admin Panel - User Responses</h2>
            <div style="margin-bottom: 20px;">
                <button class="btn" onclick="downloadResponses()">Download Raw Data (JSON)</button>
                <button class="btn" onclick="downloadResults()" style="background: #27ae60;">Download Final Results (JSON)</button>
                <button class="btn" onclick="clearAllResponses()" style="background: #e74c3c;">Clear All Data</button>
                <button class="btn" onclick="goHome()">Back to Home</button>
            </div>
            <div id="responsesContainer">
                <p>No responses yet.</p>
            </div>
            <div style="margin-top:12px;color:#666;font-size:13px;">
                <strong>Note:</strong> Responses are stored in JSONBin. If you want the master key removed from the client, move persistence to a server.
            </div>
        </div>

        <!-- Success Message -->
        <div id="successMessage" style="display: none;" class="success-message">
            <h3>✅ Test Submitted Successfully!</h3>
            <p>Thank you for taking the SSC CHSL Mathematics Practice Test.<br>Your responses have been recorded successfully.</p>
            <button class="btn" onclick="goHome()" style="margin-top: 20px; background: white; color: #2c3e50;">Back to Home</button>
        </div>
    </div>

    <!-- Admin Password Modal -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAdminModal()">&times;</span>
            <h3>Admin Access</h3>
            <input type="password" id="adminPassword" placeholder="Enter admin password">
            <div id="passwordError" class="error-message" style="display: none;">Incorrect password!</div>
            <button class="btn" onclick="checkAdminPassword()">Login</button>
        </div>
    </div>

    <script>
        /************************
         * JSONBin configuration
         *
         * WARNING: Embedding X-Master-Key in client-side code is insecure.
         * Recommended: move these operations to a small server-side endpoint.
         ************************/
        const JSONBIN_ID = '68d903e243b1c97be952d590';
        const JSONBIN_MASTER_KEY = '$2a$10$XZzc.4ipvMjGFeEh9J/7cuffWTZGYXoXCkJjMDjZ1wCgz.BGJ3Cse';

        // Helper: JSONBin v3 endpoints
        const JSONBIN_BASE = `https://api.jsonbin.io/v3/b/${JSONBIN_ID}`;

        // Questions data (unchanged)
        const questions = [
            /* (same questions array as in your original file) */
            {
                question: "If x⁴ + x⁻⁴ = 194, x > 0, then the value of (x - 2)² will be:",
                options: ["6", "3", "2", "1"],
                correct: 1
            },
            {
                question: "If a² + b² + c² = 300 and ab + bc + ca = 50, then what is the value of a + b + c? (Given that a, b and c are all positive).",
                options: ["15", "20", "22", "25"],
                correct: 1
            },
            {
                question: "In △ABC, M is the midpoint of BC. If ∠AMB = 60°, AM = 8 cm, and BC = 12 cm, then AB² + AC² is equal to:",
                options: ["200", "208", "144", "160"],
                correct: 1
            },
            {
                question: "If A alone can do a work in 24 days and A and B together can do it in 15 days, how many days will B take to do the work alone?",
                options: ["30 days", "35 days", "40 days", "45 days"],
                correct: 2
            },
            {
                question: "The value of 296 × 304 is:",
                options: ["89974", "89874", "79984", "89984"],
                correct: 3
            },
            {
                question: "If sec θ - 2cos θ = 27, where θ is positive acute angle, then the value of sec θ is:",
                options: ["5", "6", "4", "8"],
                correct: 2
            },
            {
                question: "If x + 1/x = 4, then find the value of x⁴ + 1/x⁴.",
                options: ["194", "196", "16", "14"],
                correct: 0
            },
            {
                question: "The value of cos 120° is:",
                options: ["1", "-0.5", "0", "0.5"],
                correct: 1
            },
            {
                question: "If x + y + 3 = 0, then find the value of x³ + y³ - 9xy + 9.",
                options: ["18", "-36", "36", "-18"],
                correct: 3
            },
            {
                question: "If A and B share profit in the ratio 5:4, and 10% of the profit is ₹13500, then what is B's share of the profit?",
                options: ["₹75000", "₹60000", "₹54000", "₹65000"],
                correct: 1
            },
            {
                question: "The shortest distance from the centre of a circle to a chord AB is 8 cm. If the radius of the circle is 10 cm, find the length of the chord AB.",
                options: ["16 cm", "12 cm", "8 cm", "6 cm"],
                correct: 1
            },
            {
                question: "If x⁴ - 83x² + 1 = 0, then the value of x³ - x⁻³ can be:",
                options: ["758", "739", "737", "756"],
                correct: 3
            },
            {
                question: "A train 180 m long passes a pole in 9 s. Find the speed of the train in km/h.",
                options: ["60 km/h", "72 km/h", "54 km/h", "80 km/h"],
                correct: 1
            },
            {
                question: "If 5x + 3/x = 4, then what is the value of 9x² + 25/x²?",
                options: ["251/19", "125/174", "125/144", "251/14"],
                correct: 3
            },
            {
                question: "If a + b = 8 and ab = 10, then find the value of a³ + b³.",
                options: ["312", "215", "272", "111"],
                correct: 2
            },
            {
                question: "The ratio of the efficiencies of A and B is 3:5. If they can complete a work together in 30 days, in how many days can A alone complete the work?",
                options: ["75 days", "80 days", "48 days", "50 days"],
                correct: 1
            },
            {
                question: "If 3 tan θ = √3 sin θ where 0° < θ < 90°, then the value of (sin² θ - cos² θ) is:",
                options: ["1/2", "1/3", "1/5", "1/4"],
                correct: 1
            },
            {
                question: "If x + y + z = 13, x² + y² + z² = 91, and xz = y², then the difference between z and x is:",
                options: ["6", "8", "3", "4"],
                correct: 1
            },
            {
                question: "Simplify the expression: (6a + 7b)/(36a² - 49b²)",
                options: ["1/(6a - 7b)", "6a - 7b", "7b - 6a", "6a + 7b"],
                correct: 1
            },
            {
                question: "If x⁴ + x²y² + y⁴ = 273 and x² - xy + y² = 13, then the value of xy is:",
                options: ["6", "10", "8", "4"],
                correct: 3
            },
            {
                question: "In △ABC, D and E are points on AB and AC respectively such that DE ∥ BC. If AD = 3.6 cm and AB = 5.4 cm, what is the ratio of Area(△ADE) to Area(trapezium DECB)?",
                options: ["4:5", "2:3", "4:9", "5:9"],
                correct: 0
            },
            {
                question: "The ratio of acid and water in a 12 litre mixture is 1:5. If x litre of water is added to the mixture, the ratio of acid to water becomes 1:9. What is the value of x?",
                options: ["6 litres", "8 litres", "10 litres", "4 litres"],
                correct: 1
            },
            {
                question: "A boat moves at a speed of 10 km/h in still water. The speed of the stream is 2 km/h. Find the time taken by the boat to cover a distance of 48 km downstream.",
                options: ["3 hours", "4 hours", "5 hours", "6 hours"],
                correct: 1
            },
            {
                question: "The speed of a car is 21⅓ m/s. Find the speed in km/h.",
                options: ["77 km/h", "76⅔ km/h", "70 km/h", "72 km/h"],
                correct: 1
            },
            {
                question: "If a = 500, b = 502 and c = 504, then the value of a³ + b³ + c³ - 3abc is:",
                options: ["18072", "15060", "12048", "17040"],
                correct: 0
            },
            {
                question: "x[(x+y)² - 3xy]/(x³-y³) ÷ (x³+y³)/[y[(x-y)² + 3xy]] × (x²-y²)/[(x+y)² - (x-y)²] is equal to:",
                options: ["1/4", "1", "4", "1/2"],
                correct: 2
            },
            {
                question: "If 40% of A is equal to 60% of B, then B is what percent of A?",
                options: ["60%", "66⅔%", "75%", "80%"],
                correct: 1
            },
            {
                question: "If 3a/(1-a) + 9 = 19 - 3/(1-a), then what is the value of a?",
                options: ["10/3, 10/7", "5/1, 5/4", "10/1, 10/9", "5/2, 5/3"],
                correct: 2
            },
            {
                question: "In a circle, a chord AB measures 12 cm. If the distance between two parallel tangents is 18 cm, then find the radius of the circle.",
                options: ["12 cm", "9 cm", "10 cm", "15 cm"],
                correct: 2
            },
            {
                question: "If (25.3 × 25.3 - 624.91 + 24.7 × 24.7)/((253)³ + (247)³) = 50 × 10ᵏ, where k is an integer, then the value of k is:",
                options: ["2", "3", "-3", "4"],
                correct: 1
            },
            {
                question: "If A, B and C have an average weight of 60 kg, and A:B:C = 1:2:3, then find the sum of weights of A and C.",
                options: ["100 kg", "120 kg", "150 kg", "90 kg"],
                correct: 1
            },
            {
                question: "If 3x + 4y - 2z + 9 = 17, 7x + 2y + 11z + 8 = 23 and 5x + 9y + 6z - 4 = 18, then what is the value of x + y + z - 34?",
                options: ["-28", "-14", "-31", "-45"],
                correct: 2
            },
            {
                question: "If 1 + 9r² + 81r⁴ = 256 and 1 + 3r + 9r² = 32, then find the value of 1 - 3r + 9r².",
                options: ["16", "8", "4", "12"],
                correct: 1
            },
            {
                question: "The product of (a + b + 2c) and (a² + b² + 4c² - ab - 2bc - 2ca) is:",
                options: ["a³ + b³ + 8c³ - 6abc", "a³ + b³ + 8c³ - 2abc", "a³ + b³ + 6c³ - 6abc", "a³ + b³ + 8c³ + 6abc"],
                correct: 0
            },
            {
                question: "If tan A = 12/5, then the value of cos A is:",
                options: ["13/5", "5/13", "13/12", "5/12"],
                correct: 1
            },
            {
                question: "In △ABC, the angle bisectors of ∠B and ∠C meet at O. If ∠BOC = 116°, then ∠A is equal to:",
                options: ["48°", "56°", "52°", "64°"],
                correct: 2
            },
            {
                question: "If a + b = 8 and ab = 10, then find the value of a³ + b³.",
                options: ["312", "215", "272", "111"],
                correct: 2
            },
            {
                question: "The distance between P and Q is 275 km. Two cars start simultaneously from P and Q towards each other at 7:00 am with speeds of 25 km/h and 30 km/h respectively. At what time will they meet?",
                options: ["11:00 am", "12:00 pm", "1:00 pm", "11:30 am"],
                correct: 1
            },
            {
                question: "The ratio of interest on simple interest for A (principal 5 units, 6 years) and B (principal 6 units, 5 years) at the same rate is:",
                options: ["1:1", "5:6", "6:5", "5:7"],
                correct: 0
            },
            {
                question: "A man bought 10 items for ₹11 and sold 11 items for ₹10. What is the loss percentage?",
                options: ["10%", "12%", "19%", "21%"],
                correct: 2
            },
            {
                question: "If ax + by = 3 and bx - ay = 9, then what is the value of y/x?",
                options: ["(a-3b)/(b+3a)", "(b-3a)/(a+3b)", "(a+3b)/(1+3a)", "(b-3a)/(2a+3b²)"],
                correct: 0
            },
            {
                question: "Pipe A and B can fill a tank in 10 hours and 15 hours respectively. Pipe C can empty the same tank in 20 hours. If all three pipes are opened together, in how much time will the tank be full?",
                options: ["8¾ hours", "7¾ hours", "9¾ hours", "8⅝ hours"],
                correct: 0
            },
            {
                question: "150 oranges were bought at a rate of ₹20 per dozen. If the seller wants to make a 20% profit, what should be the selling price per dozen?",
                options: ["₹22", "₹24", "₹25", "₹30"],
                correct: 1
            },
            {
                question: "A train of length 250 m passes a platform of length 350 m in 12 seconds. How much time will the train take to pass a platform of length 250 m?",
                options: ["11 seconds", "12 seconds", "15 seconds", "10 seconds"],
                correct: 3
            },
            {
                question: "If x + 1/x = 4, then find the value of x⁴ + 1/x⁴.",
                options: ["194", "196", "16", "14"],
                correct: 0
            }
            /* ... rest of the 45 questions ... */
        ];

        // ---------- (to save space in this preview I will programmatically recreate the questions array)
        // If you're pasting this into production, be sure the questions array is identical to your original file.
        // For clarity: the final copy should contain the full questions list as in your original HTML.

        // State variables (unchanged)
        let currentQuestion = 0;
        let userAnswers = {};
        let userName = '';
        let userEmail = '';
        let examTimer;
        let timeRemaining = 75 * 60; // 1 hour 15 minutes in seconds
        let examStarted = false;

        // Initialize localStorage default for backward compatibility
        if (!localStorage.getItem('quizResponses')) {
            localStorage.setItem('quizResponses', JSON.stringify([]));
        }

        /***********************
         * JSONBin helper funcs
         ***********************/
        async function fetchResponsesFromBin() {
            try {
                const resp = await fetch(`${JSONBIN_BASE}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_MASTER_KEY,
                        'Accept': 'application/json'
                    }
                });

                if (!resp.ok) {
                    console.warn('JSONBin fetch failed:', resp.status, resp.statusText);
                    throw new Error(`Fetch failed: ${resp.status}`);
                }

                const json = await resp.json();

                // JSONBin v3 can return the payload in different shapes; check common keys.
                // Try several fallbacks so this works for bins created in different styles.
                const payload = json?.record?.data ?? json?.record ?? json?.data ?? json;

                // Try common container keys, then fallback to payload itself if it's an array.
                if (Array.isArray(payload)) {
                    return payload;
                } else if (Array.isArray(payload.quizResponses)) {
                    return payload.quizResponses;
                } else if (Array.isArray(payload.responses)) {
                    return payload.responses;
                } else if (Array.isArray(payload.quiz_responses)) {
                    return payload.quiz_responses;
                } else {
                    // If the bin contains a single object with stored responses
                    return payload?.quizResponses || payload?.responses || [];
                }
            } catch (err) {
                console.warn('Error reading from JSONBin, falling back to localStorage. Error:', err);
                // fallback to localStorage
                const ls = JSON.parse(localStorage.getItem('quizResponses') || '[]');
                return ls;
            }
        }

        async function writeResponsesToBin(responsesArray) {
            try {
                const body = {
                    // store under a "quizResponses" key to make the bin structured and readable
                    data: {
                        quizResponses: responsesArray
                    }
                };

                const resp = await fetch(`${JSONBIN_BASE}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_MASTER_KEY
                    },
                    body: JSON.stringify(body)
                });

                if (!resp.ok) {
                    const txt = await resp.text();
                    console.error('JSONBin write failed:', resp.status, resp.statusText, txt);
                    throw new Error('JSONBin write failed');
                }

                // update localStorage as cache
                try {
                    localStorage.setItem('quizResponses', JSON.stringify(responsesArray));
                } catch (e) { console.warn('Could not write to localStorage:', e); }

                return true;
            } catch (err) {
                console.error('Error writing responses to JSONBin:', err);
                return false;
            }
        }

        async function appendResponseRemote(newResponse) {
            // atomic-ish: fetch, append, write. (Note: JSONBin does not provide transactions)
            const current = await fetchResponsesFromBin();
            current.push(newResponse);
            const ok = await writeResponsesToBin(current);
            return { ok, current };
        }

        // -------------------------
        // Existing exam logic (kept, with persistence changes)
        // -------------------------
        function startTimer() {
            examTimer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();

                if (timeRemaining <= 300 && timeRemaining > 60) { // Last 5 minutes warning
                    document.getElementById('timerContainer').classList.add('timer-warning');
                    document.getElementById('autoSubmitWarning').style.display = 'block';
                } else if (timeRemaining <= 60) { // Last 1 minute critical
                    document.getElementById('timerContainer').classList.remove('timer-warning');
                    document.getElementById('timerContainer').classList.add('timer-critical');
                }

                if (timeRemaining <= 0) {
                    autoSubmitTest();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const hours = Math.floor(timeRemaining / 3600);
            const minutes = Math.floor((timeRemaining % 3600) / 60);
            const seconds = timeRemaining % 60;
            
            const display = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('timerDisplay').textContent = display;
        }

        function stopTimer() {
            if (examTimer) {
                clearInterval(examTimer);
                examTimer = null;
            }
        }

        function autoSubmitTest() {
            stopTimer();
            alert('⏰ Time\'s up! Your test has been automatically submitted.');
            submitTest(true); // true indicates auto-submission
        }

        function startTest() {
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'block';
        }

        function startQuiz() {
            userName = document.getElementById('userName').value.trim();
            userEmail = document.getElementById('userEmail').value.trim();

            if (!userName || !userEmail) {
                alert('Please enter both name and email address');
                return;
            }

            if (!isValidEmail(userEmail)) {
                alert('Please enter a valid email address');
                return;
            }

            document.getElementById('userForm').style.display = 'none';
            document.getElementById('navigation').style.display = 'flex';
            
            generateQuestions();
            showQuestion(0);
            
            // Start the timer
            examStarted = true;
            startTimer();
        }

        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function generateQuestions() {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';

            questions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-container';
                questionDiv.id = `question-${index}`;

                questionDiv.innerHTML = `
                    <div class="question">
                        <div class="question-header">
                            <span class="question-number">Question ${index + 1}</span>
                        </div>
                        <div class="question-text">${q.question}</div>
                        <ul class="options">
                            ${q.options.map((option, optIndex) => `
                                <li class="option" onclick="selectOption(${index}, ${optIndex})">
                                    <label>
                                        <input type="radio" name="question-${index}" value="${optIndex}" style="margin-right: 10px;">
                                        (${String.fromCharCode(65 + optIndex)}) ${option}
                                    </label>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                `;

                container.appendChild(questionDiv);
            });
        }

        function calculateScore(answers) {
            let correct = 0;
            let incorrect = 0;
            let unattempted = 0;
            let detailedResults = {};

            for (let i = 0; i < questions.length; i++) {
                const userAnswer = answers[i];
                const correctAnswer = questions[i].correct;
                
                if (userAnswer === undefined) {
                    unattempted++;
                    detailedResults[i] = {
                        status: 'unattempted',
                        icon: '–',
                        points: 0
                    };
                } else if (userAnswer === correctAnswer) {
                    correct++;
                    detailedResults[i] = {
                        status: 'correct',
                        icon: '✅',
                        points: 2
                    };
                } else {
                    incorrect++;
                    detailedResults[i] = {
                        status: 'incorrect',
                        icon: '❌',
                        points: -0.5
                    };
                }
            }

            const totalScore = (correct * 2) + (incorrect * -0.5);
            const percentage = ((correct * 2) / (questions.length * 2)) * 100;

            return {
                correct,
                incorrect,
                unattempted,
                totalScore,
                percentage: percentage.toFixed(2),
                maxMarks: questions.length * 2,
                detailedResults
            };
        }

        function selectOption(questionIndex, optionIndex) {
            // Remove previous selections
            const options = document.querySelectorAll(`#question-${questionIndex} .option`);
            options.forEach(opt => opt.classList.remove('selected'));

            // Add selection to clicked option
            options[optionIndex].classList.add('selected');

            // Store the answer
            userAnswers[questionIndex] = optionIndex;

            // Update radio button
            const radio = document.querySelector(`input[name="question-${questionIndex}"][value="${optionIndex}"]`);
            if (radio) radio.checked = true;
        }

        function showQuestion(index) {
            // Hide all questions
            document.querySelectorAll('.question-container').forEach(q => {
                q.classList.remove('active');
            });

            // Show current question
            document.getElementById(`question-${index}`).classList.add('active');

            // Update progress
            document.getElementById('progress').textContent = `Question ${index + 1} of ${questions.length}`;

            // Update navigation buttons
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            if (prevBtn) prevBtn.disabled = (index === 0);
            
            if (index === questions.length - 1) {
                if (nextBtn) nextBtn.style.display = 'none';
                if (submitBtn) submitBtn.style.display = 'inline-block';
            } else {
                if (nextBtn) nextBtn.style.display = 'inline-block';
                if (submitBtn) submitBtn.style.display = 'none';
            }

            currentQuestion = index;
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                showQuestion(currentQuestion - 1);
            }
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                showQuestion(currentQuestion + 1);
            }
        }

        async function submitTest(isAutoSubmit = false) {
            stopTimer(); // Stop the timer immediately
            
            const confirmMessage = isAutoSubmit ? 
                'Your test has been auto-submitted due to time expiry.' :
                'Are you sure you want to submit your test? You cannot change your answers after submission.';
                
            if (!isAutoSubmit && !confirm(confirmMessage)) {
                // Restart timer if user cancels submission
                if (examStarted) {
                    startTimer();
                }
                return;
            }

            try {
                // Calculate score and results
                const scoreData = calculateScore(userAnswers);
                
                // Store user response with all question-answer details
                const response = {
                    name: userName,
                    email: userEmail,
                    answers: userAnswers,
                    detailedAnswers: {},
                    scoreData: scoreData,
                    timestamp: new Date().toISOString(),
                    submittedAt: new Date().toLocaleString(),
                    isAutoSubmitted: isAutoSubmit,
                    timeSpent: (75 * 60) - timeRemaining // Calculate time spent
                };

                // Create detailed answers for admin panel
                for (let i = 0; i < questions.length; i++) {
                    const userAnswer = userAnswers[i];
                    response.detailedAnswers[i] = {
                        questionText: questions[i].question,
                        userAnswerIndex: userAnswer !== undefined ? userAnswer : null,
                        userAnswerText: userAnswer !== undefined ? questions[i].options[userAnswer] : 'Not answered',
                        userAnswerLetter: userAnswer !== undefined ? String.fromCharCode(65 + userAnswer) : '-'
                    };
                }

                // First try to save remotely to JSONBin
                const { ok, current } = await appendResponseRemote(response);

                if (ok) {
                    console.log('Saved response to JSONBin successfully.');
                    alert('Your test has been submitted and saved to server.');
                } else {
                    // fallback: store locally
                    console.warn('Failed to save to JSONBin; storing in localStorage as fallback.');
                    let responses = JSON.parse(localStorage.getItem('quizResponses') || '[]');
                    responses.push(response);
                    localStorage.setItem('quizResponses', JSON.stringify(responses));
                    alert('Your test has been submitted locally (server save failed).');
                }

                // Hide quiz and show success message
                document.getElementById('quizContainer').style.display = 'none';
                document.getElementById('successMessage').style.display = 'block';

                console.log('Test submitted', response);
            } catch (error) {
                console.error('Error saving response:', error);
                // fallback: store locally
                let responses = JSON.parse(localStorage.getItem('quizResponses') || '[]');
                responses.push({
                    name: userName,
                    email: userEmail,
                    answers: userAnswers,
                    scoreData: calculateScore(userAnswers),
                    timestamp: new Date().toISOString(),
                    submittedAt: new Date().toLocaleString(),
                    isAutoSubmitted: isAutoSubmit,
                    timeSpent: (75 * 60) - timeRemaining
                });
                localStorage.setItem('quizResponses', JSON.stringify(responses));

                // Even if there's an error, close the test
                document.getElementById('quizContainer').style.display = 'none';
                document.getElementById('successMessage').style.display = 'block';
                alert('There was a problem saving to server — response saved locally.');
            }
        }

        function openAdminModal() {
            document.getElementById('adminModal').style.display = 'block';
        }

        function closeAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
            document.getElementById('adminPassword').value = '';
            document.getElementById('passwordError').style.display = 'none';
        }

        function checkAdminPassword() {
            const password = document.getElementById('adminPassword').value;
            if (password === 'AryanM@123M') {
                closeAdminModal();
                showAdminPanel();
            } else {
                document.getElementById('passwordError').style.display = 'block';
            }
        }

        async function showAdminPanel() {
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
            
            await displayResponses();
        }

        async function displayResponses() {
            const container = document.getElementById('responsesContainer');

            // Try remote fetch first
            const responses = await fetchResponsesFromBin();

            if (!responses || responses.length === 0) {
                container.innerHTML = '<p>No responses yet.</p>';
                return;
            }

            let html = `<h3>Total Responses: ${responses.length}</h3>`;
            
            responses.forEach((response, responseIndex) => {
                const timeSpentMinutes = Math.floor((response.timeSpent || 0) / 60);
                const timeSpentSeconds = (response.timeSpent || 0) % 60;
                const timeSpentDisplay = `${timeSpentMinutes}m ${timeSpentSeconds}s`;
                
                // Get score data (calculate if not present for backward compatibility)
                let scoreData = response.scoreData;
                if (!scoreData) {
                    scoreData = calculateScore(response.answers || {});
                }
                
                html += `<div style="margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">`;
                html += `<h4>Response #${responseIndex + 1}</h4>`;
                html += `<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;">`;
                html += `<p><strong>Name:</strong> ${response.name || '—'}</p>`;
                html += `<p><strong>Email:</strong> ${response.email || '—'}</p>`;
                html += `<p><strong>Score:</strong> ${scoreData.totalScore}/${scoreData.maxMarks}</p>`;
                html += `<p><strong>Percentage:</strong> ${scoreData.percentage}%</p>`;
                html += `</div>`;
                
                html += `<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 15px; background: #f8f9fa; padding: 10px; border-radius: 5px;">`;
                html += `<p style="margin: 0;"><span style="color: #27ae60;">✅ Correct:</span> ${scoreData.correct}</p>`;
                html += `<p style="margin: 0;"><span style="color: #e74c3c;">❌ Incorrect:</span> ${scoreData.incorrect}</p>`;
                html += `<p style="margin: 0;"><span style="color: #95a5a6;">– Unattempted:</span> ${scoreData.unattempted}</p>`;
                html += `<p style="margin: 0;"><strong>Time:</strong> ${timeSpentDisplay}</p>`;
                html += `<p style="margin: 0;"><strong>Auto Submit:</strong> ${response.isAutoSubmitted ? 'Yes' : 'No'}</p>`;
                html += `</div>`;
                
                html += `<p><strong>Submitted At:</strong> ${response.submittedAt}</p>`;
                html += `<h5 style="margin-top: 20px;">Question-wise Results:</h5>`;
                
                html += '<div style="overflow-x: auto;"><table class="response-table" style="width: 100%; font-size: 12px;"><thead><tr>';
                html += '<th style="width: 6%;">Q#</th><th style="width: 6%;">Result</th><th style="width: 8%;">Points</th><th style="width: 50%;">Question</th><th style="width: 15%;">User Answer</th><th style="width: 15%;">Correct Answer</th></tr></thead><tbody>';
                
                for (let i = 0; i < questions.length; i++) {
                    const userAnswer = (response.answers || {})[i];
                    const correctAnswer = questions[i].correct;
                    const questionText = questions[i].question.length > 60 ? 
                        questions[i].question.substring(0, 60) + '...' : 
                        questions[i].question;
                    
                    const resultIcon = scoreData.detailedResults[i]?.icon || '–';
                    const points = scoreData.detailedResults[i]?.points || 0;
                    
                    html += '<tr>';
                    html += `<td>${i + 1}</td>`;
                    html += `<td style="font-size: 16px; text-align: center;">${resultIcon}</td>`;
                    html += `<td style="font-weight: bold; color: ${points > 0 ? '#27ae60' : points < 0 ? '#e74c3c' : '#95a5a6'};">${points > 0 ? '+' : ''}${points}</td>`;
                    html += `<td style="font-size: 11px;">${questionText}</td>`;
                    
                    if (userAnswer !== undefined && userAnswer !== null) {
                        html += `<td style="font-size: 11px;">${String.fromCharCode(65 + userAnswer)}) ${questions[i].options[userAnswer].substring(0, 30)}${questions[i].options[userAnswer].length > 30 ? '...' : ''}</td>`;
                    } else {
                        html += `<td style="color: #999;">Not answered</td>`;
                    }
                    
                    html += `<td style="font-size: 11px; color: #27ae60; font-weight: bold;">${String.fromCharCode(65 + correctAnswer)}) ${questions[i].options[correctAnswer].substring(0, 30)}${questions[i].options[correctAnswer].length > 30 ? '...' : ''}</td>`;
                    html += '</tr>';
                }
                
                html += '</tbody></table></div>';
                html += '</div>';
            });

            container.innerHTML = html;
        }

        async function downloadResults() {
            const responses = await fetchResponsesFromBin();
            
            if (!responses || responses.length === 0) {
                alert('No responses to download');
                return;
            }

            const finalResults = {
                examInfo: {
                    title: "SSC CHSL Tier-I Mathematics Practice Test",
                    totalQuestions: questions.length,
                    maxMarks: questions.length * 2,
                    markingScheme: {
                        correct: "+2 marks",
                        incorrect: "-0.5 marks",
                        unattempted: "0 marks"
                    },
                    exportDate: new Date().toISOString(),
                    totalCandidates: responses.length
                },
                results: responses.map((response, index) => {
                    let scoreData = response.scoreData;
                    if (!scoreData) {
                        scoreData = calculateScore(response.answers || {});
                    }
                    const timeSpentMinutes = Math.floor((response.timeSpent || 0) / 60);
                    const timeSpentSeconds = (response.timeSpent || 0) % 60;

                    return {
                        candidateInfo: {
                            serialNo: index + 1,
                            name: response.name,
                            email: response.email,
                            submittedAt: response.submittedAt,
                            isAutoSubmitted: response.isAutoSubmitted || false,
                            timeSpent: `${timeSpentMinutes}m ${timeSpentSeconds}s`
                        },
                        scorecard: {
                            totalScore: scoreData.totalScore,
                            maxMarks: scoreData.maxMarks,
                            percentage: scoreData.percentage + "%",
                            correct: scoreData.correct,
                            incorrect: scoreData.incorrect,
                            unattempted: scoreData.unattempted,
                            breakdown: {
                                correctMarks: scoreData.correct * 2,
                                incorrectMarks: scoreData.incorrect * -0.5,
                                unattemptedMarks: 0
                            }
                        },
                        questionWiseResults: questions.map((question, qIndex) => {
                            const userAnswer = (response.answers || {})[qIndex];
                            const correctAnswer = question.correct;
                            const result = scoreData.detailedResults[qIndex];

                            return {
                                questionNo: qIndex + 1,
                                question: question.question,
                                options: question.options,
                                correctAnswer: {
                                    index: correctAnswer,
                                    option: String.fromCharCode(65 + correctAnswer),
                                    text: question.options[correctAnswer]
                                },
                                userAnswer: userAnswer !== undefined ? {
                                    index: userAnswer,
                                    option: String.fromCharCode(65 + userAnswer),
                                    text: question.options[userAnswer]
                                } : {
                                    index: null,
                                    option: "Not Answered",
                                    text: "Not Answered"
                                },
                                result: {
                                    status: result?.status || 'unattempted',
                                    icon: result?.icon || '–',
                                    points: result?.points || 0,
                                    isCorrect: result?.status === 'correct'
                                }
                            };
                        })
                    };
                })
            };

            const dataStr = JSON.stringify(finalResults, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `ssc_chsl_final_results_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        async function downloadResponses() {
            const responses = await fetchResponsesFromBin();
            
            if (!responses || responses.length === 0) {
                alert('No responses to download');
                return;
            }

            const exportData = {
                exportDate: new Date().toISOString(),
                totalResponses: responses.length,
                questions: questions.map((q, i) => ({
                    questionNumber: i + 1,
                    question: q.question,
                    options: q.options,
                    correctAnswer: String.fromCharCode(65 + q.correct)
                })),
                responses: responses.map((response, responseIndex) => {
                    const detailedAnswers = {};
                    for (let i = 0; i < questions.length; i++) {
                        const userAnswer = (response.answers || {})[i];
                        detailedAnswers[`Q${i+1}`] = {
                            question: questions[i].question,
                            userAnswer: userAnswer !== undefined ? questions[i].options[userAnswer] : 'Not answered',
                            userAnswerLetter: userAnswer !== undefined ? String.fromCharCode(65 + userAnswer) : '-',
                            correctAnswer: String.fromCharCode(65 + questions[i].correct)
                        };
                    }
                    
                    return {
                        responseNumber: responseIndex + 1,
                        name: response.name,
                        email: response.email,
                        submittedAt: response.submittedAt,
                        timeSpent: response.timeSpent || 0,
                        isAutoSubmitted: response.isAutoSubmitted || false,
                        answers: detailedAnswers
                    };
                })
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `ssc_chsl_responses_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        async function clearAllResponses() {
            if (!confirm('Are you sure you want to delete all user responses? This cannot be undone.')) {
                return;
            }

            // For safety: clear localStorage, then try to write an empty array to JSONBin
            localStorage.removeItem('quizResponses');

            const ok = await writeResponsesToBin([]);

            if (ok) {
                await displayResponses();
                alert('All responses have been cleared from the server and local cache.');
            } else {
                alert('Failed to clear responses on server. Local responses cleared only.');
                await displayResponses();
            }
        }

        function goHome() {
            stopTimer(); // Stop timer when going home
            
            document.getElementById('landingPage').style.display = 'block';
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            
            // Reset quiz state
            currentQuestion = 0;
            userAnswers = {};
            userName = '';
            userEmail = '';
            timeRemaining = 75 * 60; // Reset timer
            examStarted = false;
            updateTimerDisplay();
            document.getElementById('userName').value = '';
            document.getElementById('userEmail').value = '';
            document.getElementById('userForm').style.display = 'block';
            document.getElementById('navigation').style.display = 'none';
            document.getElementById('autoSubmitWarning').style.display = 'none';
            document.getElementById('timerContainer').classList.remove('timer-warning', 'timer-critical');
        }

        // Prevent page refresh/close during exam
        window.addEventListener('beforeunload', function (e) {
            if (examStarted && timeRemaining > 0) {
                const message = 'Your exam is in progress. Are you sure you want to leave? Your progress will be lost.';
                e.preventDefault();
                e.returnValue = message;
                return message;
            }
        });

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            const modal = document.getElementById('adminModal');
            if (event.target === modal) {
                closeAdminModal();
            }
        }

        // Handle Enter key in password field
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('adminPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkAdminPassword();
                }
            });
            
            // Initialize timer display
            updateTimerDisplay();
        });

        // Prevent right-click context menu during exam
        document.addEventListener('contextmenu', function(e) {
            if (examStarted) {
                e.preventDefault();
            }
        });

        // Prevent common keyboard shortcuts during exam
        document.addEventListener('keydown', function(e) {
            if (examStarted) {
                // Prevent F5 (refresh)
                if (e.key === 'F5') {
                    e.preventDefault();
                }
                // Prevent Ctrl+R (refresh)
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                }
                // Prevent F12 (developer tools)
                if (e.key === 'F12') {
                    e.preventDefault();
                }
            }
        });
    </script>
</body>
</html>
