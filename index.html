<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>SSC CHSL Tier-I Mathematics Practice Test</title>
    <style>
        /* (unchanged CSS — same as your original file) */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Arial', sans-serif; line-height: 1.6; color: #333; background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height: 100vh; }
        .container { max-width:1200px;margin:0 auto;padding:20px; }
        .header { text-align:center;background:#fff;padding:40px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.2);margin-bottom:30px;border-top:5px solid #e74c3c; }
        .govt-logo{width:80px;height:80px;background:#e74c3c;border-radius:50%;margin:0 auto 20px;display:flex;align-items:center;justify-content:center;color:white;font-size:24px;font-weight:bold;}
        .header h1{color:#2c3e50;margin-bottom:10px;font-size:2.4em;font-weight:bold;text-transform:uppercase;letter-spacing:1px;}
        .header h2{color:#e74c3c;font-weight:bold;margin-bottom:10px;font-size:1.3em;}
        .header .subtitle{color:#7f8c8d;font-size:1.1em;margin-bottom:20px;font-style:italic;}
        .exam-info {
    background: #f8f9fa;
    padding: 25px 30px;
    border-radius: 12px;
    margin: 20px 0;
    border-left: 6px solid #3498db;
    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.2);
    max-width: 100%;
    text-align: left; /* align text to the left */
    font-size: 16px;
    line-height: 1.6;
    color: #2c3e50;
}

.exam-info h3 {
    color: #2c3e50;
    margin-bottom: 15px;
    font-weight: 700;
    font-size: 1.5em;
    text-align: left; /* ensure heading is aligned left */
}

.exam-info ul {
    list-style: none;
    padding-left: 20px; /* padding for bullet alignment */
    margin: 0;
}

.exam-info li {
    margin: 8px 0;
    padding-left: 20px;
    position: relative;
    text-align: left;
}

.exam-info li:before {
    content: "•"; /* bullet */
    color: #3498db;
    font-weight: bold;
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    font-size: 18px;
}
.btn{background:linear-gradient(45deg,#3498db,#2980b9);color:white;border:none;padding:18px 35px;border-radius:8px;cursor:pointer;font-size:16px;font-weight:bold;text-transform:uppercase;letter-spacing:1px;transition:all 0.3s ease;margin:10px;box-shadow:0 4px 15px rgba(0,0,0,0.2);}
        .btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,0.3);}
        .btn-admin{background:linear-gradient(45deg,#e74c3c,#c0392b);}
        .quiz-container{display:none;background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.2);overflow:hidden;}
        .exam-header{background:linear-gradient(45deg,#2c3e50,#34495e);color:white;padding:20px 30px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;}
        .exam-title{font-size:1.3em;font-weight:bold;}
        .timer-container{background:#e74c3c;padding:12px 20px;border-radius:8px;font-family:'Courier New',monospace;font-size:1.2em;font-weight:bold;box-shadow:0 2px 10px rgba(0,0,0,0.3);min-width:160px;text-align:center;}
        .timer-label{font-size:0.8em;margin-bottom:5px;opacity:0.9;}
        .timer-display{font-size:1.4em;letter-spacing:2px;}
        .timer-warning{background:#f39c12 !important;animation:pulse 1s infinite;}
        .timer-critical{background:#e74c3c !important;animation:flash 0.5s infinite;}
        @keyframes pulse{0%{opacity:1;}50%{opacity:0.7;}100%{opacity:1;}}
        @keyframes flash{0%{opacity:1;}50%{opacity:0.3;}100%{opacity:1;}}
        .user-form{background:#f8f9fa;padding:30px;border-bottom:1px solid #e9ecef;}
        .user-form h3{color:#2c3e50;margin-bottom:20px;font-size:1.4em;}
        .user-form input{width:100%;padding:15px;margin:10px 0;border:2px solid #ddd;border-radius:6px;font-size:16px;transition:border-color 0.3s ease;}
        .user-form input:focus{outline:none;border-color:#3498db;box-shadow:0 0 0 3px rgba(52,152,219,0.1);}
        .question-container{display:none;padding:30px;}
        .question-container.active{display:block;}
        .question{background:#fff;border:2px solid #e9ecef;border-radius:10px;padding:30px;margin-bottom:20px;box-shadow:0 4px 15px rgba(0,0,0,0.1);}
        .question-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px;padding-bottom:15px;border-bottom:2px solid #e9ecef;}
        .question-number{background:linear-gradient(45deg,#3498db,#2980b9);color:white;padding:10px 20px;border-radius:25px;font-weight:bold;font-size:16px;}
        .question-text{font-size:18px;margin-bottom:25px;color:#2c3e50;line-height:1.8;font-weight:500;}
        .options{list-style:none;}
        .option{margin-bottom:15px;padding:15px 20px;border:2px solid #e9ecef;border-radius:8px;cursor:pointer;transition:all 0.3s ease;background:#f8f9fa;position:relative;}
        .option:hover{background:#e3f2fd;border-color:#2196f3;transform:translateX(5px);}
        .option.selected{background:linear-gradient(45deg,#3498db,#2980b9);border-color:#2980b9;color:white;font-weight:bold;}
        .option label{cursor:pointer;display:block;width:100%;font-size:16px;}
        .navigation{display:flex;justify-content:space-between;align-items:center;padding:25px 30px;background:#f8f9fa;border-top:1px solid #e9ecef;}
        .btn-nav{background:linear-gradient(45deg,#27ae60,#2ecc71);color:white;border:none;padding:12px 25px;border-radius:6px;cursor:pointer;font-size:16px;font-weight:bold;text-transform:uppercase;transition:all 0.3s ease;box-shadow:0 3px 10px rgba(0,0,0,0.2);}
        .btn-nav:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,0,0,0.3);}
        .btn-nav:disabled{background:#bdc3c7;cursor:not-allowed;transform:none;box-shadow:none;}
        #submitBtn{background:linear-gradient(45deg,#e74c3c,#c0392b) !important;}
        .progress{flex:1;margin:0 20px;text-align:center;color:#2c3e50;font-size:18px;font-weight:bold;background:white;padding:10px 20px;border-radius:25px;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
        .modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,0.7);backdrop-filter:blur(5px);}
        .modal-content{background-color:#fff;margin:10% auto;padding:40px;border-radius:12px;width:90%;max-width:500px;box-shadow:0 10px 40px rgba(0,0,0,0.3);border-top:5px solid #e74c3c;}
        .modal h3{margin-bottom:25px;color:#2c3e50;font-size:1.5em;}
        .modal input{width:100%;padding:15px;margin:15px 0;border:2px solid #ddd;border-radius:6px;font-size:16px;}
        .close{color:#aaa;float:right;font-size:32px;font-weight:bold;cursor:pointer;margin-top:-15px;}
        .close:hover{color:#e74c3c;}
        .admin-panel{display:none;background:#fff;padding:40px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.2);border-top:5px solid #e74c3c;}
        .response-table{width:100%;border-collapse:collapse;margin-top:20px;font-size:14px;}
        .response-table th,.response-table td{border:1px solid #ddd;padding:12px;text-align:left;}
        .response-table th{background:linear-gradient(45deg,#2c3e50,#34495e);color:white;font-weight:bold;}
        .response-table tr:nth-child(even){background-color:#f9f9f9;}
        .success-message{background:linear-gradient(45deg,#27ae60,#2ecc71);color:white;padding:40px;border-radius:12px;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,0.2);}
        .success-message h3{font-size:2em;margin-bottom:20px;}
        .error-message{background:#f8d7da;color:#721c24;padding:15px;border-radius:8px;text-align:center;margin-top:10px;border:1px solid #f5c6cb;}
        .auto-submit-warning{background:#fff3cd;color:#856404;padding:20px;border-radius:8px;text-align:center;margin:20px 0;border:1px solid #ffeaa7;font-weight:bold;}
        /* responsive css omitted for brevity in this snippet - same as your original file */
    </style>
</head>
<body>
    <div class="container">
        <!-- Landing Page -->
        <div id="landingPage">
            <div class="header">
                <div class="govt-logo">SSC</div>
                <h1>Staff Selection Commission</h1>
                <h2>CHSL Tier-I Mathematics Practice Test 2</h2>
                <p class="subtitle">Combined Higher Secondary Level Examination</p>
                <div class="exam-info">
                    <h3>Examination Instructions:</h3>
                    <ul>
                        <li>Total Questions: 45</li>
                        <li>Maximum Marks: 90</li>
                        <li>Time Duration: <strong style="color: rgb(253, 5, 5); font-weight: 1000; ">1 Hour 15 Minutes</strong></li>
                        <li><strong style="color: rgb(253, 5, 5); font-weight: 1000;">⚠️ Test will auto-submit when time expires</strong></li>
                        <li>Ensure stable internet connection</li>
                        <li><strong style="color: rgb(253, 5, 5); font-weight: 1000;">Do not refresh the page during exam</strong></li>
                        <li>Marking Scheme: +2 for correct, -0.5 for incorrect, 0 for unattempted</li>
                    </ul>
                </div>
                <button class="btn" onclick="startTest()">Start Examination</button>
                <button class="btn btn-admin" onclick="openAdminModal()">Admin Panel</button>
            </div>
        </div>

        <!-- Quiz Container -->
        <div id="quizContainer" class="quiz-container">
            <div class="exam-header">
                <div class="exam-title">SSC CHSL - Mathematics Practice Test</div>
                <div class="timer-container" id="timerContainer">
                    <div class="timer-label">TIME REMAINING</div>
                    <div class="timer-display" id="timerDisplay">01:15:00</div>
                </div>
            </div>

            <!-- User Information Form -->
            <div id="userForm" class="user-form">
                <h3>Candidate Information</h3>
                <input type="text" id="userName" placeholder="Enter your Name" required>
                <input type="email" id="userEmail" placeholder="Enter Given email address" required>
                <button class="btn" onclick="startQuiz()">Begin Examination</button>
            </div>

            <!-- Auto Submit Warning -->
            <div id="autoSubmitWarning" class="auto-submit-warning" style="display: none;">
                ⚠️ WARNING: Test will be automatically submitted in less than 5 minutes!
            </div>

            <!-- Questions will be dynamically inserted here -->
            <div id="questionsContainer"></div>

            <!-- Navigation -->
            <div class="navigation" id="navigation" style="display: none;">
                <button class="btn-nav" id="prevBtn" onclick="previousQuestion()" disabled>Previous</button>
                <div class="progress" id="progress">Question 1 of 45</div>
                <button class="btn-nav" id="nextBtn" onclick="nextQuestion()">Next</button>
                <button class="btn-nav" id="submitBtn" onclick="submitTest()" style="display: none;">Submit Test</button>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="adminPanel" class="admin-panel">
            <h2 style="color: #2c3e50; margin-bottom: 20px;">Admin Panel - User Responses</h2>
            <div style="margin-bottom: 20px;">
                <button class="btn" onclick="downloadResponses()">Download Raw Data (JSON)</button>
                <button class="btn" onclick="downloadResults()" style="background: #27ae60;">Download Final Results (JSON)</button>
                <button class="btn" onclick="clearAllResponses()" style="background: #e74c3c;">Clear All Data</button>
                <button class="btn" onclick="goHome()">Back to Home</button>
            </div>
            <div id="responsesContainer">
                <p>No responses yet.</p>
            </div>
            <div style="margin-top:12px;color:#666;font-size:13px;">
                <strong>Note:</strong> Responses are stored in JSONBin. If you want the master key removed from the client, move persistence to a server.
            </div>
        </div>

        <!-- Success Message -->
        <div id="successMessage" style="display: none;" class="success-message">
            <h3>✅ Test Submitted Successfully!</h3>
            <p>Thank you for taking the SSC CHSL Mathematics Practice Test.<br>Your responses have been recorded successfully.</p>
            <button class="btn" onclick="goHome()" style="margin-top: 20px; background: white; color: #2c3e50;">Back to Home</button>
        </div>
    </div>

    <!-- Admin Password Modal -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAdminModal()">&times;</span>
            <h3>Admin Access</h3>
            <input type="password" id="adminPassword" placeholder="Enter admin password">
            <div id="passwordError" class="error-message" style="display: none;">Incorrect password!</div>
            <button class="btn" onclick="checkAdminPassword()">Login</button>
        </div>
    </div>

    <script>
        /************************
         * JSONBin configuration
         *
         * WARNING: Embedding X-Master-Key in client-side code is insecure.
         * Recommended: move these operations to a small server-side endpoint.
         ************************/
        const JSONBIN_ID = '68d903e243b1c97be952d590';
        const JSONBIN_MASTER_KEY = '$2a$10$XZzc.4ipvMjGFeEh9J/7cuffWTZGYXoXCkJjMDjZ1wCgz.BGJ3Cse';

        // Helper: JSONBin v3 endpoints
        const JSONBIN_BASE = `https://api.jsonbin.io/v3/b/${JSONBIN_ID}`;

        // Questions data (unchanged)
        const questions = [
            /* (same questions array as in your original file) */
            [
  {
    "question": "If $\\cot A = \\frac{15}{8}$, then get the value of $\\tan 2A$ will be:",
    "options": ["$\\frac{240}{173}$", "$\\frac{240}{161}$", "$\\frac{220}{171}$", "$\\frac{200}{161}$"],
    "correct": 1,
    "solution": "Given $\\cot A = \\frac{15}{8}$, so $\\tan A = \\frac{8}{15}$. Using the identity $\\tan 2A = \\frac{2 \\tan A}{1 - \\tan^2 A} = \\frac{2 \\times \\frac{8}{15}}{1 - (\\frac{8}{15})^2} = \\frac{16/15}{1 - 64/225} = \\frac{16/15}{161/225} = \\frac{16}{15} \\times \\frac{225}{161} = \\frac{240}{161}$."
  },
  {
    "question": "If $2a+b=10$ and $2ab=9$, then the value of $(2a-b)$ will be:",
    "options": ["10", "4", "8", "6"],
    "correct": 2,
    "solution": "Using $(2a-b)^2 = (2a+b)^2 - 8ab$. Given $2a+b=10$ and $2ab=9$, so $8ab=36$. $(2a-b)^2 = 10^2 - 36 = 100 - 36 = 64$. Thus, $2a-b = 8$."
  },
  {
    "question": "If $3\\sqrt{\\frac{1-a}{a}}+9=19-3\\sqrt{\\frac{a}{1-a}}$ then what is the value of $a$?",
    "options": ["$3/10, 7/10$", "$1/10, 9/10$", "$2/5, 3/5$", "$1/5, 4/5$"],
    "correct": 1,
    "solution": "The equation simplifies to $\\sqrt{\\frac{1-a}{a}}+\\sqrt{\\frac{a}{1-a}}=\\frac{10}{3}$. Let $y = \\sqrt{\\frac{1-a}{a}}$, so $y + 1/y = 10/3$. This yields $3y^2 - 10y + 3 = 0$, or $(3y-1)(y-3)=0$. $y=3$ or $y=1/3$. If $y=3$, $\\frac{1-a}{a}=9 \\implies a = 1/10$. If $y=1/3$, $\\frac{1-a}{a}=1/9 \\implies a = 9/10$."
  },
  {
    "question": "Simplify the following expression $(3x+2y)^{2}-(3x-2y)^{2}$.",
    "options": ["$9x^{2}-4y^{2}$", "$12xy$", "$18x^{2}-8y^{2}$", "$24xy$"],
    "correct": 3,
    "solution": "Using the identity $a^2-b^2 = (a+b)(a-b)$: $[(3x+2y)+(3x-2y)][(3x+2y)-(3x-2y)] = (6x)(4y) = 24xy$."
  },
  {
    "question": "If $x+y=2$ and $\\frac{1}{x}+\\frac{1}{y}=\\frac{18}{5}$, then the value of $(x^{3}+y^{3})$ is:",
    "options": ["$4\\frac{2}{3}$", "$4\\frac{3}{5}$", "$3\\frac{1}{5}$", "$3\\frac{1}{3}$"],
    "correct": 0,
    "solution": "From $\\frac{1}{x}+\\frac{1}{y}=\\frac{x+y}{xy}=\\frac{18}{5}$ and $x+y=2$, we get $\\frac{2}{xy}=\\frac{18}{5}$, so $xy=\\frac{10}{18}=\\frac{5}{9}$. $x^3+y^3 = (x+y)^3 - 3xy(x+y) = 2^3 - 3(\\frac{5}{9})(2) = 8 - \\frac{10}{3} = \\frac{24-10}{3} = \\frac{14}{3} = 4\\frac{2}{3}$."
  },
  {
    "question": "In right-angled triangle PQR, $PQ=5\\text{ cm}$, $QR = 13\\text{ cm}$ and $\\angle P=90^{\\circ}$ then find the value of $(\\tan Q - \\tan R)$.",
    "options": ["$\\frac{60}{119}$", "$\\frac{119}{60}$", "$\\frac{14}{5}$", "$\\frac{5}{14}$"],
    "correct": 1,
    "solution": "By Pythagoras theorem, $PR = \\sqrt{13^2 - 5^2} = 12\\text{ cm}$. $\\tan Q = \\frac{PR}{PQ} = \\frac{12}{5}$ and $\\tan R = \\frac{PQ}{PR} = \\frac{5}{12}$. $\\tan Q - \\tan R = \\frac{12}{5} - \\frac{5}{12} = \\frac{144-25}{60} = \\frac{119}{60}$."
  },
  {
    "question": "If $\\sin \\theta=\\frac{8}{17}$ then find the value of $\\tan \\theta$.",
    "options": ["$\\frac{15}{17}$", "$\\frac{8}{15}$", "$\\frac{17}{8}$", "$\\frac{15}{8}$"],
    "correct": 1,
    "solution": "Given $\\sin \\theta = \\frac{8}{17}$ (Perpendicular/Hypotenuse). The base is $\\sqrt{17^2 - 8^2} = \\sqrt{289-64} = 15$. $\\tan \\theta = \\frac{\\text{Perpendicular}}{\\text{Base}} = \\frac{8}{15}$."
  },
  {
    "question": "If $x^{2}-4x+1=0,$ then what is the value of $x^{9}+x^{7}-194x^{5}-194x^{3}$?",
    "options": ["4", "-4", "1", "-1"],
    "correct": 1,
    "solution": "From $x^2-4x+1=0$, we get $x+\\frac{1}{x}=4$. Squaring gives $x^4+\\frac{1}{x^4}=194$, or $x^4-194 = -\\frac{1}{x^4}$. The expression is $x^5(x^4-194) + x^3(x^4-194) = (x^5+x^3)(-\\frac{1}{x^4}) = -(x+\\frac{1}{x}) = -4$."
  },
  {
    "question": "If $x=2+\\sqrt{3}$, find the value of $x^{4}-8x^{3}+16x^{2}$.",
    "options": ["1", "3", "0", "2"],
    "correct": 0,
    "solution": "From $x=2+\\sqrt{3}$, we get $x-2=\\sqrt{3}$. Squaring gives $x^2-4x+4=3$, or $x^2-4x=-1$. Squaring this result gives $(x^2-4x)^2 = (-1)^2$, so $x^4-8x^3+16x^2 = 1$."
  },
  {
    "question": "If $x^{2}-3\\sqrt{2}x+1=0$ then what is the value of $x^{3}+\\frac{1}{x^{3}}$?",
    "options": ["$30\\sqrt{6}$", "$45\\sqrt{2}$", "$15\\sqrt{6}$", "$30\\sqrt{2}$"],
    "correct": 1,
    "solution": "From $x^2-3\\sqrt{2}x+1=0$, we get $x+\\frac{1}{x}=3\\sqrt{2}$. Using $k^3-3k$: $x^3+\\frac{1}{x^3} = (3\\sqrt{2})^3 - 3(3\\sqrt{2}) = 54\\sqrt{2} - 9\\sqrt{2} = 45\\sqrt{2}$."
  },
  {
    "question": "If $a+b+c=\\frac{7}{12}$, $3a-4b+5c=\\frac{3}{4}$ and $7a-11b-13c=-\\frac{7}{12}$, then what is the value of $a+c$?",
    "options": ["$1/2$", "$5/12$", "$3/4$", "$1/4$"],
    "correct": 1,
    "solution": "Solving the system of linear equations yields $a = \\frac{1}{3}$ and $c = \\frac{1}{12}$. Thus, $a+c = \\frac{1}{3} + \\frac{1}{12} = \\frac{4+1}{12} = \\frac{5}{12}$."
  },
  {
    "question": "The value of $\\cos 120^{\\circ}$ is:",
    "options": ["1", "-0.5", "0", "0.5"],
    "correct": 1,
    "solution": "$\\cos 120^{\\circ} = \\cos(180^{\\circ}-60^{\\circ}) = -\\cos 60^{\\circ} = -\\frac{1}{2} = -0.5$."
  },
  {
    "question": "If $a^{2}+b^{2}+c^{2}=a b+b c+c a$ then the value of $\\frac{11a^{4}+13b^{4}+15c^{4}}{16a^{2}b^{2}+19b^{2}c^{2}+17c^{2}a^{2}}$ is:",
    "options": ["$\\frac{1}{4}$", "$\\frac{3}{4}$", "$1\\frac{1}{3}$", "$1\\frac{3}{4}$"],
    "correct": 1,
    "solution": "The condition $a^2+b^2+c^2=ab+bc+ca$ implies $a=b=c$. Substituting $a=b=c=1$ into the expression gives $\\frac{11+13+15}{16+19+17} = \\frac{39}{52} = \\frac{3}{4}$."
  },
  {
    "question": "If $x^{4}+\\frac{1}{x^{4}}=727$, $x>1$. then what is the value of $(x-\\frac{1}{x})$?",
    "options": ["$\\pm 6$", "$\\pm 5$", "$\\pm 4$", "$\\pm 3$"],
    "correct": 1,
    "solution": "Adding 2 to both sides gives $(x^2+\\frac{1}{x^2})^2 = 729$, so $x^2+\\frac{1}{x^2} = 27$. Subtracting 2 gives $(x-\\frac{1}{x})^2 = 25$, so $x-\\frac{1}{x} = \\pm 5$."
  },
  {
    "question": "$\\triangle ABC$ is a right angle triangle. If $\\angle B=90^{\\circ}$ and $\\tan A=\\frac{1}{\\sqrt{3}}$ then find the value of $(\\sin A \\cos C + \\cos A \\sin C)$.",
    "options": ["$\\frac{1}{3}$", "$\\frac{2}{3}$", "2", "1"],
    "correct": 3,
    "solution": "The expression $\\sin A \\cos C + \\cos A \\sin C$ is $\\sin(A+C)$. Since $\\angle B=90^{\\circ}$, $A+C=90^{\\circ}$. Thus, $\\sin(A+C) = \\sin 90^{\\circ} = 1$."
  },
  {
    "question": "If $x=4+\\sqrt{15}$, what is the value of $(x^{2}+\\frac{1}{x^{2}})$?",
    "options": ["48", "54", "72", "62"],
    "correct": 3,
    "solution": "If $x=4+\\sqrt{15}$, then $\\frac{1}{x}=4-\\sqrt{15}$. $x+\\frac{1}{x}=8$. $x^2+\\frac{1}{x^2} = (x+\\frac{1}{x})^2 - 2 = 8^2 - 2 = 64-2 = 62$."
  },
  {
    "question": "If $\\sqrt{x}+\\frac{1}{\\sqrt{x}}=2\\sqrt{3}$ then $x^{4}+\\frac{1}{x^{4}}$ will be:",
    "options": ["10406", "9602", "9606", "10402"],
    "correct": 1,
    "solution": "Squaring gives $x+\\frac{1}{x}+2 = 12$, so $x+\\frac{1}{x}=10$. Squaring again gives $x^2+\\frac{1}{x^2}=100-2=98$. Squaring again gives $x^4+\\frac{1}{x^4}=98^2-2 = 9604-2 = 9602$."
  },
  {
    "question": "If $x^{4}+\\frac{1}{x^{4}}=14159$, then the value of $x+\\frac{1}{x}$ is:",
    "options": ["9", "10", "11", "12"],
    "correct": 2,
    "solution": "Adding 2 to both sides yields $(x^2+\\frac{1}{x^2})^2 = 14161$, so $x^2+\\frac{1}{x^2}=119$. Adding 2 again yields $(x+\\frac{1}{x})^2 = 121$, so $x+\\frac{1}{x}=11$."
  },
  {
    "question": "If $\\sec \\theta - 2 \\cos \\theta = \\frac{7}{2}$ where $\\theta$ is positive acute angle, then the value of $\\sec \\theta$ is.",
    "options": ["5", "6", "4", "8"],
    "correct": 2,
    "solution": "Substituting $\\sec \\theta = 1/\\cos \\theta$ gives $\\frac{1}{\\cos \\theta} - 2 \\cos \\theta = \\frac{7}{2}$, which leads to $4\\cos^2 \\theta + 7\\cos \\theta - 2 = 0$. Factoring gives $(4\\cos \\theta - 1)(\\cos \\theta + 2) = 0$. Since $\\cos \\theta \\neq -2$, $\\cos \\theta = 1/4$, so $\\sec \\theta = 4$."
  },
  {
    "question": "A man buys 2 apples and 3 kiwi fruits for $₹ 37$. If he buys 4 apples and 5 kiwi fruits for $₹ 67$ then what will be the total cost of 1 apple and 1 kiwi fruit?",
    "options": ["$₹ 20$", "$₹ 18$", "$₹ 15$", "$₹ 28$"],
    "correct": 2,
    "solution": "Let $x$ be the cost of an apple and $y$ a kiwi. $2x+3y=37$ and $4x+5y=67$. Solving gives $x=8$ and $y=7$. The total cost is $x+y=15$."
  },
  {
    "question": "The value of $\\frac{1}{8}[\\frac{1}{b-1}-\\frac{1}{b+1}-\\frac{2}{b^{2}+1}-\\frac{4}{b^{4}+1}]$ is:",
    "options": ["$\\frac{1}{b^{8}-1}$", "$\\frac{1}{b^{8}+1}$", "$\\frac{8}{b^{8}+1}$", "$\\frac{8}{b^{8}-1}$"],
    "correct": 0,
    "solution": "Using $a-b=1/c$ and the difference of squares identity iteratively: $\\frac{1}{b-1}-\\frac{1}{b+1} = \\frac{2}{b^2-1}$. Then $\\frac{2}{b^2-1} - \\frac{2}{b^2+1} = \\frac{4}{b^4-1}$. Then $\\frac{4}{b^4-1} - \\frac{4}{b^4+1} = \\frac{8}{b^8-1}$. The final result is $\\frac{1}{8} \\times \\frac{8}{b^8-1} = \\frac{1}{b^8-1}$."
  },
  {
    "question": "If $a=8, b=5$ and $c=-9$ then the value of $\\sqrt{4a+8b-c}$ will be:",
    "options": ["9", "12", "15", "8"],
    "correct": 0,
    "solution": "Substitute the values: $\\sqrt{4(8)+8(5)-(-9)} = \\sqrt{32+40+9} = \\sqrt{81} = 9$. (Note: This question is derived from an identity where $a=8, b=5, c=-9$ are found by equating squared terms to zero.)"
  },
  {
    "question": "If $a+b=8$ and $ab=10,$ then the value of $a^{3}+b^{3}$ is:",
    "options": ["312", "215", "272", "111"],
    "correct": 2,
    "solution": "Using $a^3+b^3 = (a+b)((a+b)^2 - 3ab) = 8(8^2 - 3(10)) = 8(64-30) = 8(34) = 272$."
  },
  {
    "question": "If $x=2$ and $y=3$ then solve the expression $\\frac{\\sqrt{x}-\\sqrt{y}}{\\sqrt{x}+\\sqrt{y}}$",
    "options": ["$2\\sqrt{6}-6$", "$5-2\\sqrt{6}$", "$2\\sqrt{6}-5$", "$\\sqrt{6}-5$"],
    "correct": 2,
    "solution": "Substitute $x=2$ and $y=3$: $\\frac{\\sqrt{2}-\\sqrt{3}}{\\sqrt{2}+\\sqrt{3}}$. Rationalize: $\\frac{(\\sqrt{2}-\\sqrt{3})^2}{2-3} = \\frac{2+3-2\\sqrt{6}}{-1} = \\frac{5-2\\sqrt{6}}{-1} = 2\\sqrt{6}-5$."
  },
  {
    "question": "If $a^{3}-b^{3}=899$ and $a-b=29,$ then the value of $(a-b)^{2}+3ab$ is equal to:",
    "options": ["35", "16", "29", "31"],
    "correct": 3,
    "solution": "The expression $(a-b)^2+3ab$ is equivalent to $a^2-2ab+b^2+3ab = a^2+ab+b^2$. We know $a^3-b^3 = (a-b)(a^2+ab+b^2)$. Thus, $a^2+ab+b^2 = \\frac{899}{29} = 31$."
  },
  {
    "question": "If $\\tan 3\\theta \\cdot \\tan 7\\theta = 1$. where $7\\theta$ is an acute angle, then find the value of $\\cot 15\\theta$.",
    "options": ["$-\\sqrt{3}$", "1", "-1", "$\\sqrt{3}$"],
    "correct": 2,
    "solution": "Since $\\tan A \\cdot \\tan B = 1$, we have $A+B = 90^{\\circ}$, so $3\\theta+7\\theta=90^{\\circ} \\implies 10\\theta=90^{\\circ} \\implies \\theta=9^{\\circ}$. $\\cot 15\\theta = \\cot(15 \\times 9^{\\circ}) = \\cot 135^{\\circ} = -1$."
  },
  {
    "question": "The sum and difference of two numbers is 27 and 3 respectively. What is the ratio of two numbers?",
    "options": ["$5:3$", "$2:1$", "$4:7$", "$5:4$"],
    "correct": 3,
    "solution": "Let the numbers be $x$ and $y$. $x+y=27$ and $x-y=3$. Adding gives $2x=30$, $x=15$. Subtracting gives $2y=24$, $y=12$. The ratio is $15:12$, which simplifies to $5:4$."
  },
  {
    "question": "If $a-b=3$ and $a^{3}-b^{3}=999$ then find the value of $a^{2}-b^{2}$.",
    "options": ["60", "62", "64", "63"],
    "correct": 3,
    "solution": "We find $a^2+ab+b^2 = 999/3 = 333$. Using $(a-b)^2+3ab = a^2+ab+b^2$: $3^2+3ab=333 \\implies 3ab=324 \\implies ab=108$. Then $(a+b)^2 = (a-b)^2+4ab = 9+4(108) = 441$, so $a+b=21$. $a^2-b^2 = (a+b)(a-b) = 21 \\times 3 = 63$."
  },
  {
    "question": "If $x-4y=0$ and $x+2y=24,$ then what is the value of $\\frac{2x+3y}{2x-3y}$?",
    "options": ["$\\frac{9}{5}$", "$\\frac{11}{5}$", "$\\frac{13}{7}$", "$\\frac{9}{7}$"],
    "correct": 1,
    "solution": "From $x-4y=0$, $x=4y$. Substitute into the second equation: $4y+2y=24$, so $6y=24$, $y=4$. $x=16$. $\\frac{2(16)+3(4)}{2(16)-3(4)} = \\frac{32+12}{32-12} = \\frac{44}{20} = \\frac{11}{5}$."
  },
  {
    "question": "If $\\sin \\theta=\\frac{9}{41}$ and $0^{\\circ}<\\theta<90^{\\circ}.$ then the value of $\\cot \\theta$ is:",
    "options": ["$\\frac{39}{9}$", "$\\frac{35}{8}$", "$\\frac{40}{9}$", "$\\frac{47}{8}$"],
    "correct": 2,
    "solution": "Given $\\sin \\theta = \\frac{9}{41}$ (Perpendicular/Hypotenuse). The base is $\\sqrt{41^2 - 9^2} = \\sqrt{1600} = 40$. $\\cot \\theta = \\frac{\\text{Base}}{\\text{Perpendicular}} = \\frac{40}{9}$."
  },
  {
    "question": "If $\\sqrt{x}-\\frac{1}{\\sqrt{x}}=\\sqrt{3}$ then the value of $x^{4}+\\frac{1}{x^{4}}$ will be:",
    "options": ["531", "623", "527", "7"],
    "correct": 2,
    "solution": "Squaring $\\sqrt{x}-\\frac{1}{\\sqrt{x}}=\\sqrt{3}$ gives $x+\\frac{1}{x}=5$. Squaring again gives $x^2+\\frac{1}{x^2}=23$. Squaring again gives $x^4+\\frac{1}{x^4}=23^2-2 = 527$."
  },
  {
    "question": "If $a+b+c=11$ and $ab+bc+ca=28$, then find the value of $a^{3}+b^{3}+c^{3}-3abc$.",
    "options": ["1639", "407", "1093", "2255"],
    "correct": 1,
    "solution": "Use $a^{3}+b^{3}+c^{3}-3abc = (a+b+c)[(a+b+c)^2 - 3(ab+bc+ca)]$. $= 11[11^2 - 3(28)] = 11[121-84] = 11 \\times 37 = 407$."
  },
  {
    "question": "If $x^{2}-6x+1=0,$ then the value of $\\frac{x^{4}+x^{-2}}{x^{2}+1}$ is:",
    "options": ["36", "33", "35", "39"],
    "correct": 1,
    "solution": "From $x^2-6x+1=0$, we get $x+\\frac{1}{x}=6$. $x^3+\\frac{1}{x^3} = 6^3 - 3(6) = 198$. The expression is $\\frac{x^3+\\frac{1}{x^3}}{x+\\frac{1}{x}} = \\frac{198}{6} = 33$."
  },
  {
    "question": "If $x^{4}+x^{-4}=6887$ then the positive value of $x-x^{-1}$ is:",
    "options": ["9", "8", "12", "15"],
    "correct": 0,
    "solution": "Adding 2 gives $(x^2+\\frac{1}{x^2})^2 = 6889$, so $x^2+\\frac{1}{x^2}=83$. Subtracting 2 gives $(x-\\frac{1}{x})^2 = 81$, so $x-\\frac{1}{x}=9$ (since $x>0$ implies the positive value is typically sought)."
  },
  {
    "question": "If $x+y=4$ and $\\frac{1}{x}+\\frac{1}{y}=\\frac{16}{15},$ then what is the value of $(x^{3}+y^{3})$?",
    "options": ["18", "16", "19", "21"],
    "correct": 2,
    "solution": "From $\\frac{x+y}{xy}=\\frac{16}{15}$ and $x+y=4$, we get $xy = \\frac{4 \\times 15}{16} = \\frac{15}{4}$. $x^3+y^3 = (x+y)^3 - 3xy(x+y) = 4^3 - 3(\\frac{15}{4})(4) = 64-45 = 19$."
  },
  {
    "question": "If $x^{2}-5\\sqrt{5}x+1=0$ and $x>0$ then the value of $(x^{3}-\\frac{1}{x^{3}})$ will be:",
    "options": ["1331", "1296", "1244", "1364"],
    "correct": 3,
    "solution": "From $x^2-5\\sqrt{5}x+1=0$, we get $x+\\frac{1}{x}=5\\sqrt{5}$. Then $x-\\frac{1}{x} = \\sqrt{(5\\sqrt{5})^2-4} = \\sqrt{121}=11$. $x^3-\\frac{1}{x^3} = (11)^3 + 3(11) = 1331+33 = 1364$."
  },
  {
    "question": "The value of $x^{3}+y^{3}+z^{3}-3xyz,$ when $x=555,$ $y=556$ and $z=557,$ is:",
    "options": ["5006", "5002", "5004", "5008"],
    "correct": 2,
    "solution": "The numbers are consecutive ($d=1$). Use $x^3+y^3+z^3-3xyz = 9d^2 (x+y+z)/3 = 3d^2(x+y+z)$. $= 3(1^2)(555+556+557) = 3(1668) = 5004$."
  },
  {
    "question": "If $8 \\cot \\theta = 6$ then find the value of $\\frac{\\sin \\theta+\\cos \\theta}{\\sin \\theta-\\cos \\theta}$.",
    "options": ["7", "2", "5", "12"],
    "correct": 0,
    "solution": "$\\cot \\theta = 6/8 = 3/4$. Divide numerator and denominator by $\\sin \\theta$: $\\frac{1+\\cot \\theta}{1-\\cot \\theta} = \\frac{1+3/4}{1-3/4} = \\frac{7/4}{1/4} = 7$."
  },
  {
    "question": "In $\\triangle ABC,$ $B$ is right angled and $\\cot A=\\frac{1}{2}$ then find the value of $\\frac{\\sin A(\\cos C+\\cos A)}{\\cos C(\\sin C-\\sin A)}$.",
    "options": ["3", "-3", "2", "-2"],
    "correct": 1,
    "solution": "If $\\cot A = 1/2$, then $\\tan A = 2$. With $\\angle B=90^{\\circ}$, $\\sin A = 2/\\sqrt{5}$, $\\cos A = 1/\\sqrt{5}$, $\\sin C = 1/\\sqrt{5}$, $\\cos C = 2/\\sqrt{5}$. Substituting: $\\frac{2/\\sqrt{5}(2/\\sqrt{5}+1/\\sqrt{5})}{2/\\sqrt{5}(1/\\sqrt{5}-2/\\sqrt{5})} = \\frac{2/\\sqrt{5} \\cdot 3/\\sqrt{5}}{2/\\sqrt{5} \\cdot (-1/\\sqrt{5})} = -3$."
  },
  {
    "question": "If $\\cos A = \\frac{9}{41}$, then find the value of $\\cot A$.",
    "options": ["$\\frac{41}{40}$", "$\\frac{9}{40}$", "$\\frac{40}{9}$", "$\\frac{9}{41}$"],
    "correct": 1,
    "solution": "Given $\\cos A = \\frac{9}{41}$ (Base/Hypotenuse). Perpendicular is $\\sqrt{41^2 - 9^2} = 40$. $\\cot A = \\frac{\\text{Base}}{\\text{Perpendicular}} = \\frac{9}{40}$."
  },
  {
    "question": "If $\\tan A = \\frac{5}{12}$ then the value of $\\cos A$ is:",
    "options": ["$\\frac{5}{13}$", "$\\frac{13}{5}$", "$\\frac{12}{13}$", "$\\frac{12}{5}$"],
    "correct": 2,
    "solution": "Given $\\tan A = \\frac{5}{12}$ (Perpendicular/Base). Hypotenuse is $\\sqrt{5^2+12^2} = 13$. $\\cos A = \\frac{\\text{Base}}{\\text{Hypotenuse}} = \\frac{12}{13}$."
  },
  {
    "question": "If $\\frac{4}{3}(x^{2}+\\frac{1}{x^{2}})=110\\frac{2}{3}$ then find $\\frac{1}{9}(x^{3}-\\frac{1}{x^{3}});$ where $x>0$.",
    "options": ["74", "85", "84", "76"],
    "correct": 2,
    "solution": "The equation simplifies to $x^2+\\frac{1}{x^2} = \\frac{332}{3} \\times \\frac{3}{4} = 83$. Then $x-\\frac{1}{x} = \\sqrt{83-2} = 9$. $x^3-\\frac{1}{x^3} = 9^3 + 3(9) = 756$. $\\frac{1}{9}(x^3-\\frac{1}{x^3}) = \\frac{756}{9} = 84$."
  },
  {
    "question": "If $4x^{4}-37x^{2}+9=0$, $x>\\sqrt{\\frac{3}{2}}$, then what is the value of $8x^{3}-\\frac{27}{x^{3}}$?",
    "options": ["35", "215", "-215", "-35"],
    "correct": 1,
    "solution": "Let $a=x^2$. $4a^2-37a+9=0 \\implies (4a-1)(a-9)=0$. Since $x^2 > 1.5$, $x^2=9$, so $x=3$. Substitute $x=3$: $8(3)^3 - \\frac{27}{3^3} = 8(27) - 1 = 216-1 = 215$."
  },
  {
    "question": "If $x+\\frac{1}{x}=4$ then find the value of $x^{4}+\\frac{1}{x^{4}}$ is:",
    "options": ["194", "196", "16", "14"],
    "correct": 0,
    "solution": "Given $x+\\frac{1}{x}=4$. $x^2+\\frac{1}{x^2} = 4^2-2=14$. $x^4+\\frac{1}{x^4} = 14^2-2 = 196-2 = 194$."
  },
  {
    "question": "If $u+v=84$ and $u-v=4,$ then $u:v$ is equal to?",
    "options": ["$11:10$", "$10:11$", "$10:9$", "$9:10$"],
    "correct": 0,
    "solution": "Adding the equations gives $2u=88$, so $u=44$. Subtracting gives $2v=80$, so $v=40$. $u:v = 44:40 = 11:10$."
  }
]
            /* ... rest of the 45 questions ... */
        ];

        // ---------- (to save space in this preview I will programmatically recreate the questions array)
        // If you're pasting this into production, be sure the questions array is identical to your original file.
        // For clarity: the final copy should contain the full questions list as in your original HTML.

        // State variables (unchanged)
        let currentQuestion = 0;
        let userAnswers = {};
        let userName = '';
        let userEmail = '';
        let examTimer;
        let timeRemaining = 75 * 60; // 1 hour 15 minutes in seconds
        let examStarted = false;

        // Initialize localStorage default for backward compatibility
        if (!localStorage.getItem('quizResponses')) {
            localStorage.setItem('quizResponses', JSON.stringify([]));
        }

        /***********************
         * JSONBin helper funcs
         ***********************/
        async function fetchResponsesFromBin() {
            try {
                const resp = await fetch(`${JSONBIN_BASE}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_MASTER_KEY,
                        'Accept': 'application/json'
                    }
                });

                if (!resp.ok) {
                    console.warn('JSONBin fetch failed:', resp.status, resp.statusText);
                    throw new Error(`Fetch failed: ${resp.status}`);
                }

                const json = await resp.json();

                // JSONBin v3 can return the payload in different shapes; check common keys.
                // Try several fallbacks so this works for bins created in different styles.
                const payload = json?.record?.data ?? json?.record ?? json?.data ?? json;

                // Try common container keys, then fallback to payload itself if it's an array.
                if (Array.isArray(payload)) {
                    return payload;
                } else if (Array.isArray(payload.quizResponses)) {
                    return payload.quizResponses;
                } else if (Array.isArray(payload.responses)) {
                    return payload.responses;
                } else if (Array.isArray(payload.quiz_responses)) {
                    return payload.quiz_responses;
                } else {
                    // If the bin contains a single object with stored responses
                    return payload?.quizResponses || payload?.responses || [];
                }
            } catch (err) {
                console.warn('Error reading from JSONBin, falling back to localStorage. Error:', err);
                // fallback to localStorage
                const ls = JSON.parse(localStorage.getItem('quizResponses') || '[]');
                return ls;
            }
        }

        async function writeResponsesToBin(responsesArray) {
            try {
                const body = {
                    // store under a "quizResponses" key to make the bin structured and readable
                    data: {
                        quizResponses: responsesArray
                    }
                };

                const resp = await fetch(`${JSONBIN_BASE}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_MASTER_KEY
                    },
                    body: JSON.stringify(body)
                });

                if (!resp.ok) {
                    const txt = await resp.text();
                    console.error('JSONBin write failed:', resp.status, resp.statusText, txt);
                    throw new Error('JSONBin write failed');
                }

                // update localStorage as cache
                try {
                    localStorage.setItem('quizResponses', JSON.stringify(responsesArray));
                } catch (e) { console.warn('Could not write to localStorage:', e); }

                return true;
            } catch (err) {
                console.error('Error writing responses to JSONBin:', err);
                return false;
            }
        }

        async function appendResponseRemote(newResponse) {
            // atomic-ish: fetch, append, write. (Note: JSONBin does not provide transactions)
            const current = await fetchResponsesFromBin();
            current.push(newResponse);
            const ok = await writeResponsesToBin(current);
            return { ok, current };
        }

        // -------------------------
        // Existing exam logic (kept, with persistence changes)
        // -------------------------
        function startTimer() {
            examTimer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();

                if (timeRemaining <= 300 && timeRemaining > 60) { // Last 5 minutes warning
                    document.getElementById('timerContainer').classList.add('timer-warning');
                    document.getElementById('autoSubmitWarning').style.display = 'block';
                } else if (timeRemaining <= 60) { // Last 1 minute critical
                    document.getElementById('timerContainer').classList.remove('timer-warning');
                    document.getElementById('timerContainer').classList.add('timer-critical');
                }

                if (timeRemaining <= 0) {
                    autoSubmitTest();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const hours = Math.floor(timeRemaining / 3600);
            const minutes = Math.floor((timeRemaining % 3600) / 60);
            const seconds = timeRemaining % 60;
            
            const display = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('timerDisplay').textContent = display;
        }

        function stopTimer() {
            if (examTimer) {
                clearInterval(examTimer);
                examTimer = null;
            }
        }

        function autoSubmitTest() {
            stopTimer();
            alert('⏰ Time\'s up! Your test has been automatically submitted.');
            submitTest(true); // true indicates auto-submission
        }

        function startTest() {
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'block';
        }

        function startQuiz() {
            userName = document.getElementById('userName').value.trim();
            userEmail = document.getElementById('userEmail').value.trim();

            if (!userName || !userEmail) {
                alert('Please enter both name and email address');
                return;
            }

            if (!isValidEmail(userEmail)) {
                alert('Please enter a valid email address');
                return;
            }

            document.getElementById('userForm').style.display = 'none';
            document.getElementById('navigation').style.display = 'flex';
            
            generateQuestions();
            showQuestion(0);
            
            // Start the timer
            examStarted = true;
            startTimer();
        }

        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function generateQuestions() {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';

            questions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-container';
                questionDiv.id = `question-${index}`;

                questionDiv.innerHTML = `
                    <div class="question">
                        <div class="question-header">
                            <span class="question-number">Question ${index + 1}</span>
                        </div>
                        <div class="question-text">${q.question}</div>
                        <ul class="options">
                            ${q.options.map((option, optIndex) => `
                                <li class="option" onclick="selectOption(${index}, ${optIndex})">
                                    <label>
                                        <input type="radio" name="question-${index}" value="${optIndex}" style="margin-right: 10px;">
                                        (${String.fromCharCode(65 + optIndex)}) ${option}
                                    </label>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                `;

                container.appendChild(questionDiv);
            });
        }

        function calculateScore(answers) {
            let correct = 0;
            let incorrect = 0;
            let unattempted = 0;
            let detailedResults = {};

            for (let i = 0; i < questions.length; i++) {
                const userAnswer = answers[i];
                const correctAnswer = questions[i].correct;
                
                if (userAnswer === undefined) {
                    unattempted++;
                    detailedResults[i] = {
                        status: 'unattempted',
                        icon: '–',
                        points: 0
                    };
                } else if (userAnswer === correctAnswer) {
                    correct++;
                    detailedResults[i] = {
                        status: 'correct',
                        icon: '✅',
                        points: 2
                    };
                } else {
                    incorrect++;
                    detailedResults[i] = {
                        status: 'incorrect',
                        icon: '❌',
                        points: -0.5
                    };
                }
            }

            const totalScore = (correct * 2) + (incorrect * -0.5);
            const percentage = ((correct * 2) / (questions.length * 2)) * 100;

            return {
                correct,
                incorrect,
                unattempted,
                totalScore,
                percentage: percentage.toFixed(2),
                maxMarks: questions.length * 2,
                detailedResults
            };
        }

        function selectOption(questionIndex, optionIndex) {
            // Remove previous selections
            const options = document.querySelectorAll(`#question-${questionIndex} .option`);
            options.forEach(opt => opt.classList.remove('selected'));

            // Add selection to clicked option
            options[optionIndex].classList.add('selected');

            // Store the answer
            userAnswers[questionIndex] = optionIndex;

            // Update radio button
            const radio = document.querySelector(`input[name="question-${questionIndex}"][value="${optionIndex}"]`);
            if (radio) radio.checked = true;
        }

        function showQuestion(index) {
            // Hide all questions
            document.querySelectorAll('.question-container').forEach(q => {
                q.classList.remove('active');
            });

            // Show current question
            document.getElementById(`question-${index}`).classList.add('active');

            // Update progress
            document.getElementById('progress').textContent = `Question ${index + 1} of ${questions.length}`;

            // Update navigation buttons
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            if (prevBtn) prevBtn.disabled = (index === 0);
            
            if (index === questions.length - 1) {
                if (nextBtn) nextBtn.style.display = 'none';
                if (submitBtn) submitBtn.style.display = 'inline-block';
            } else {
                if (nextBtn) nextBtn.style.display = 'inline-block';
                if (submitBtn) submitBtn.style.display = 'none';
            }

            currentQuestion = index;
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                showQuestion(currentQuestion - 1);
            }
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                showQuestion(currentQuestion + 1);
            }
        }

        async function submitTest(isAutoSubmit = false) {
            stopTimer(); // Stop the timer immediately
            
            const confirmMessage = isAutoSubmit ? 
                'Your test has been auto-submitted due to time expiry.' :
                'Are you sure you want to submit your test? You cannot change your answers after submission.';
                
            if (!isAutoSubmit && !confirm(confirmMessage)) {
                // Restart timer if user cancels submission
                if (examStarted) {
                    startTimer();
                }
                return;
            }

            try {
                // Calculate score and results
                const scoreData = calculateScore(userAnswers);
                
                // Store user response with all question-answer details
                const response = {
                    name: userName,
                    email: userEmail,
                    answers: userAnswers,
                    detailedAnswers: {},
                    scoreData: scoreData,
                    timestamp: new Date().toISOString(),
                    submittedAt: new Date().toLocaleString(),
                    isAutoSubmitted: isAutoSubmit,
                    timeSpent: (75 * 60) - timeRemaining // Calculate time spent
                };

                // Create detailed answers for admin panel
                for (let i = 0; i < questions.length; i++) {
                    const userAnswer = userAnswers[i];
                    response.detailedAnswers[i] = {
                        questionText: questions[i].question,
                        userAnswerIndex: userAnswer !== undefined ? userAnswer : null,
                        userAnswerText: userAnswer !== undefined ? questions[i].options[userAnswer] : 'Not answered',
                        userAnswerLetter: userAnswer !== undefined ? String.fromCharCode(65 + userAnswer) : '-'
                    };
                }

                // First try to save remotely to JSONBin
                const { ok, current } = await appendResponseRemote(response);

                if (ok) {
                    console.log('Saved response to JSONBin successfully.');
                    alert('Your test has been submitted and saved to server.');
                } else {
                    // fallback: store locally
                    console.warn('Failed to save to JSONBin; storing in localStorage as fallback.');
                    let responses = JSON.parse(localStorage.getItem('quizResponses') || '[]');
                    responses.push(response);
                    localStorage.setItem('quizResponses', JSON.stringify(responses));
                    alert('Your test has been submitted locally (server save failed).');
                }

                // Hide quiz and show success message
                document.getElementById('quizContainer').style.display = 'none';
                document.getElementById('successMessage').style.display = 'block';

                console.log('Test submitted', response);
            } catch (error) {
                console.error('Error saving response:', error);
                // fallback: store locally
                let responses = JSON.parse(localStorage.getItem('quizResponses') || '[]');
                responses.push({
                    name: userName,
                    email: userEmail,
                    answers: userAnswers,
                    scoreData: calculateScore(userAnswers),
                    timestamp: new Date().toISOString(),
                    submittedAt: new Date().toLocaleString(),
                    isAutoSubmitted: isAutoSubmit,
                    timeSpent: (75 * 60) - timeRemaining
                });
                localStorage.setItem('quizResponses', JSON.stringify(responses));

                // Even if there's an error, close the test
                document.getElementById('quizContainer').style.display = 'none';
                document.getElementById('successMessage').style.display = 'block';
                alert('There was a problem saving to server — response saved locally.');
            }
        }

        function openAdminModal() {
            document.getElementById('adminModal').style.display = 'block';
        }

        function closeAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
            document.getElementById('adminPassword').value = '';
            document.getElementById('passwordError').style.display = 'none';
        }

        function checkAdminPassword() {
            const password = document.getElementById('adminPassword').value;
            if (password === 'AryanM@123M') {
                closeAdminModal();
                showAdminPanel();
            } else {
                document.getElementById('passwordError').style.display = 'block';
            }
        }

        async function showAdminPanel() {
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
            
            await displayResponses();
        }

        async function displayResponses() {
            const container = document.getElementById('responsesContainer');

            // Try remote fetch first
            const responses = await fetchResponsesFromBin();

            if (!responses || responses.length === 0) {
                container.innerHTML = '<p>No responses yet.</p>';
                return;
            }

            let html = `<h3>Total Responses: ${responses.length}</h3>`;
            
            responses.forEach((response, responseIndex) => {
                const timeSpentMinutes = Math.floor((response.timeSpent || 0) / 60);
                const timeSpentSeconds = (response.timeSpent || 0) % 60;
                const timeSpentDisplay = `${timeSpentMinutes}m ${timeSpentSeconds}s`;
                
                // Get score data (calculate if not present for backward compatibility)
                let scoreData = response.scoreData;
                if (!scoreData) {
                    scoreData = calculateScore(response.answers || {});
                }
                
                html += `<div style="margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">`;
                html += `<h4>Response #${responseIndex + 1}</h4>`;
                html += `<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;">`;
                html += `<p><strong>Name:</strong> ${response.name || '—'}</p>`;
                html += `<p><strong>Email:</strong> ${response.email || '—'}</p>`;
                html += `<p><strong>Score:</strong> ${scoreData.totalScore}/${scoreData.maxMarks}</p>`;
                html += `<p><strong>Percentage:</strong> ${scoreData.percentage}%</p>`;
                html += `</div>`;
                
                html += `<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 15px; background: #f8f9fa; padding: 10px; border-radius: 5px;">`;
                html += `<p style="margin: 0;"><span style="color: #27ae60;">✅ Correct:</span> ${scoreData.correct}</p>`;
                html += `<p style="margin: 0;"><span style="color: #e74c3c;">❌ Incorrect:</span> ${scoreData.incorrect}</p>`;
                html += `<p style="margin: 0;"><span style="color: #95a5a6;">– Unattempted:</span> ${scoreData.unattempted}</p>`;
                html += `<p style="margin: 0;"><strong>Time:</strong> ${timeSpentDisplay}</p>`;
                html += `<p style="margin: 0;"><strong>Auto Submit:</strong> ${response.isAutoSubmitted ? 'Yes' : 'No'}</p>`;
                html += `</div>`;
                
                html += `<p><strong>Submitted At:</strong> ${response.submittedAt}</p>`;
                html += `<h5 style="margin-top: 20px;">Question-wise Results:</h5>`;
                
                html += '<div style="overflow-x: auto;"><table class="response-table" style="width: 100%; font-size: 12px;"><thead><tr>';
                html += '<th style="width: 6%;">Q#</th><th style="width: 6%;">Result</th><th style="width: 8%;">Points</th><th style="width: 50%;">Question</th><th style="width: 15%;">User Answer</th><th style="width: 15%;">Correct Answer</th></tr></thead><tbody>';
                
                for (let i = 0; i < questions.length; i++) {
                    const userAnswer = (response.answers || {})[i];
                    const correctAnswer = questions[i].correct;
                    const questionText = questions[i].question.length > 60 ? 
                        questions[i].question.substring(0, 60) + '...' : 
                        questions[i].question;
                    
                    const resultIcon = scoreData.detailedResults[i]?.icon || '–';
                    const points = scoreData.detailedResults[i]?.points || 0;
                    
                    html += '<tr>';
                    html += `<td>${i + 1}</td>`;
                    html += `<td style="font-size: 16px; text-align: center;">${resultIcon}</td>`;
                    html += `<td style="font-weight: bold; color: ${points > 0 ? '#27ae60' : points < 0 ? '#e74c3c' : '#95a5a6'};">${points > 0 ? '+' : ''}${points}</td>`;
                    html += `<td style="font-size: 11px;">${questionText}</td>`;
                    
                    if (userAnswer !== undefined && userAnswer !== null) {
                        html += `<td style="font-size: 11px;">${String.fromCharCode(65 + userAnswer)}) ${questions[i].options[userAnswer].substring(0, 30)}${questions[i].options[userAnswer].length > 30 ? '...' : ''}</td>`;
                    } else {
                        html += `<td style="color: #999;">Not answered</td>`;
                    }
                    
                    html += `<td style="font-size: 11px; color: #27ae60; font-weight: bold;">${String.fromCharCode(65 + correctAnswer)}) ${questions[i].options[correctAnswer].substring(0, 30)}${questions[i].options[correctAnswer].length > 30 ? '...' : ''}</td>`;
                    html += '</tr>';
                }
                
                html += '</tbody></table></div>';
                html += '</div>';
            });

            container.innerHTML = html;
        }

        async function downloadResults() {
            const responses = await fetchResponsesFromBin();
            
            if (!responses || responses.length === 0) {
                alert('No responses to download');
                return;
            }

            const finalResults = {
                examInfo: {
                    title: "SSC CHSL Tier-I Mathematics Practice Test",
                    totalQuestions: questions.length,
                    maxMarks: questions.length * 2,
                    markingScheme: {
                        correct: "+2 marks",
                        incorrect: "-0.5 marks",
                        unattempted: "0 marks"
                    },
                    exportDate: new Date().toISOString(),
                    totalCandidates: responses.length
                },
                results: responses.map((response, index) => {
                    let scoreData = response.scoreData;
                    if (!scoreData) {
                        scoreData = calculateScore(response.answers || {});
                    }
                    const timeSpentMinutes = Math.floor((response.timeSpent || 0) / 60);
                    const timeSpentSeconds = (response.timeSpent || 0) % 60;

                    return {
                        candidateInfo: {
                            serialNo: index + 1,
                            name: response.name,
                            email: response.email,
                            submittedAt: response.submittedAt,
                            isAutoSubmitted: response.isAutoSubmitted || false,
                            timeSpent: `${timeSpentMinutes}m ${timeSpentSeconds}s`
                        },
                        scorecard: {
                            totalScore: scoreData.totalScore,
                            maxMarks: scoreData.maxMarks,
                            percentage: scoreData.percentage + "%",
                            correct: scoreData.correct,
                            incorrect: scoreData.incorrect,
                            unattempted: scoreData.unattempted,
                            breakdown: {
                                correctMarks: scoreData.correct * 2,
                                incorrectMarks: scoreData.incorrect * -0.5,
                                unattemptedMarks: 0
                            }
                        },
                        questionWiseResults: questions.map((question, qIndex) => {
                            const userAnswer = (response.answers || {})[qIndex];
                            const correctAnswer = question.correct;
                            const result = scoreData.detailedResults[qIndex];

                            return {
                                questionNo: qIndex + 1,
                                question: question.question,
                                options: question.options,
                                correctAnswer: {
                                    index: correctAnswer,
                                    option: String.fromCharCode(65 + correctAnswer),
                                    text: question.options[correctAnswer]
                                },
                                userAnswer: userAnswer !== undefined ? {
                                    index: userAnswer,
                                    option: String.fromCharCode(65 + userAnswer),
                                    text: question.options[userAnswer]
                                } : {
                                    index: null,
                                    option: "Not Answered",
                                    text: "Not Answered"
                                },
                                result: {
                                    status: result?.status || 'unattempted',
                                    icon: result?.icon || '–',
                                    points: result?.points || 0,
                                    isCorrect: result?.status === 'correct'
                                }
                            };
                        })
                    };
                })
            };

            const dataStr = JSON.stringify(finalResults, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `ssc_chsl_final_results_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        async function downloadResponses() {
            const responses = await fetchResponsesFromBin();
            
            if (!responses || responses.length === 0) {
                alert('No responses to download');
                return;
            }

            const exportData = {
                exportDate: new Date().toISOString(),
                totalResponses: responses.length,
                questions: questions.map((q, i) => ({
                    questionNumber: i + 1,
                    question: q.question,
                    options: q.options,
                    correctAnswer: String.fromCharCode(65 + q.correct)
                })),
                responses: responses.map((response, responseIndex) => {
                    const detailedAnswers = {};
                    for (let i = 0; i < questions.length; i++) {
                        const userAnswer = (response.answers || {})[i];
                        detailedAnswers[`Q${i+1}`] = {
                            question: questions[i].question,
                            userAnswer: userAnswer !== undefined ? questions[i].options[userAnswer] : 'Not answered',
                            userAnswerLetter: userAnswer !== undefined ? String.fromCharCode(65 + userAnswer) : '-',
                            correctAnswer: String.fromCharCode(65 + questions[i].correct)
                        };
                    }
                    
                    return {
                        responseNumber: responseIndex + 1,
                        name: response.name,
                        email: response.email,
                        submittedAt: response.submittedAt,
                        timeSpent: response.timeSpent || 0,
                        isAutoSubmitted: response.isAutoSubmitted || false,
                        answers: detailedAnswers
                    };
                })
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `ssc_chsl_responses_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        async function clearAllResponses() {
            if (!confirm('Are you sure you want to delete all user responses? This cannot be undone.')) {
                return;
            }

            // For safety: clear localStorage, then try to write an empty array to JSONBin
            localStorage.removeItem('quizResponses');

            const ok = await writeResponsesToBin([]);

            if (ok) {
                await displayResponses();
                alert('All responses have been cleared from the server and local cache.');
            } else {
                alert('Failed to clear responses on server. Local responses cleared only.');
                await displayResponses();
            }
        }

        function goHome() {
            stopTimer(); // Stop timer when going home
            
            document.getElementById('landingPage').style.display = 'block';
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            
            // Reset quiz state
            currentQuestion = 0;
            userAnswers = {};
            userName = '';
            userEmail = '';
            timeRemaining = 75 * 60; // Reset timer
            examStarted = false;
            updateTimerDisplay();
            document.getElementById('userName').value = '';
            document.getElementById('userEmail').value = '';
            document.getElementById('userForm').style.display = 'block';
            document.getElementById('navigation').style.display = 'none';
            document.getElementById('autoSubmitWarning').style.display = 'none';
            document.getElementById('timerContainer').classList.remove('timer-warning', 'timer-critical');
        }

        // Prevent page refresh/close during exam
        window.addEventListener('beforeunload', function (e) {
            if (examStarted && timeRemaining > 0) {
                const message = 'Your exam is in progress. Are you sure you want to leave? Your progress will be lost.';
                e.preventDefault();
                e.returnValue = message;
                return message;
            }
        });

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            const modal = document.getElementById('adminModal');
            if (event.target === modal) {
                closeAdminModal();
            }
        }

        // Handle Enter key in password field
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('adminPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkAdminPassword();
                }
            });
            
            // Initialize timer display
            updateTimerDisplay();
        });

        // Prevent right-click context menu during exam
        document.addEventListener('contextmenu', function(e) {
            if (examStarted) {
                e.preventDefault();
            }
        });

        // Prevent common keyboard shortcuts during exam
        document.addEventListener('keydown', function(e) {
            if (examStarted) {
                // Prevent F5 (refresh)
                if (e.key === 'F5') {
                    e.preventDefault();
                }
                // Prevent Ctrl+R (refresh)
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                }
                // Prevent F12 (developer tools)
                if (e.key === 'F12') {
                    e.preventDefault();
                }
            }
        });
    </script>
</body>
</html>
